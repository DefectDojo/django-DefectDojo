---
    version: '3.7'
    services:
      uwsgi:
        entrypoint: ['/wait-for-it.sh', 'mysql:${DD_DATABASE_PORT}', '-t', '30', '--', '/entrypoint-uwsgi-dev.sh']
        volumes:
          - '.:/app:z'
        environment:
          DD_DEBUG: 'True'
          DD_ADMIN_USER: "${DD_ADMIN_USER:-admin}"
          DD_ADMIN_PASSWORD: "${DD_ADMIN_PASSWORD:-admin}"
        ports:
          - target: ${DD_DEBUG_PORT:-3000}
            published: ${DD_DEBUG_PORT:-3000}
            protocol: tcp
            mode: host
      celeryworker:
        volumes:
          - '.:/app:z'
      celerybeat:
        volumes:
          - '.:/app:z'
      initializer:
        volumes:
          - '.:/app:z'
        environment:
          DD_ADMIN_USER: "${DD_ADMIN_USER:-admin}"
          DD_ADMIN_PASSWORD: "${DD_ADMIN_PASSWORD:-admin}"
      nginx:
        volumes:
          - './dojo/static/dojo:/usr/share/nginx/html/static/dojo'
      database:
        ports:
          - target: ${DD_DATABASE_PORT}
            published: ${DD_DATABASE_PORT}
            protocol: tcp
            mode: host
      # Admin interface for PostgreSQL, can be started with 'docker compose --profile pgadmin up'
      # Only useful when using PostgreSQL as database
      pgadmin:
        image: dpage/pgadmin4:6.4@sha256:e379d900081261dce78482e9a66bdc6f4c0dbe5924133cf7a3cd0c424ae6014f
        profiles:
          - pgadmin
        depends_on:
          - database
        environment:
          PGADMIN_DEFAULT_EMAIL: pgadmin@defectdojo.org
          PGADMIN_DEFAULT_PASSWORD: defectdojo
        ports:
          - target: 80
            published: 8081
            protocol: tcp
            mode: host
        volumes:
          - defectdojo_pgadmin:/var/lib/pgadmin  
    volumes:
      defectdojo_pgadmin: {}
