"""
Tests for metrics database queries
"""

from datetime import datetime, timezone
from unittest.mock import patch

from django.test import RequestFactory, TestCase
from django.urls import reverse

from dojo.engagement import views
from dojo.models import User


class EngagementViewTest(TestCase):
    fixtures = ['dojo_testdata.json']

    def setUp(self):
        user = User.objects.get(username='admin')
        test = self.client.force_login(user)

    @patch('django.utils.timezone.now')
    def test_engagement_queries(self, mock_timezone):
        mock_datetime = datetime(2020, 12, 9, tzinfo=timezone.utc)
        mock_timezone.return_value = mock_datetime

        with self.assertNumQueries(26):
            response = self.client.get(reverse('engagements_all'))
            self.assertEqual(response.status_code, 200)
            self.assertEqual(response.content, b'\n\n\n<!DOCTYPE html>\n<html lang="en">\n\n<head>\n\n    <meta charset="utf-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <meta name="description" content="">\n    <meta name="author" content="">\n    <title>\n        \n            \n                All Engagements |\n            \n        \n        DefectDojo\n    </title>\n    \n    \n\n    <!-- jQuery -->\n    <script src="/static/jquery/dist/jquery.js"></script>\n    <!--  jQuery UI -->\n    <script src="/static/components-jqueryui/jquery-ui.min.js"></script>\n    <!-- Bootstrap Core JavaScript -->\n    <script src="/static/bootstrap/dist/js/bootstrap.min.js"></script>\n\n    <!-- Metis Menu Plugin JavaScript -->\n    <script src="/static/metismenu/dist/metisMenu.min.js"></script>\n\n    <script src="/static/chosen-js/chosen.jquery.min.js"></script>\n\n    <!-- Custom Theme JavaScript -->\n    <script src="/static/startbootstrap-sb-admin-2/dist/js/sb-admin-2.js"></script>\n    <!-- Calendar JavaScript -->\n    <script src="/static/moment/min/moment.min.js"></script>\n    <script src="/static/fullcalendar/dist/fullcalendar.min.js"></script>\n    <!-- jquery cookie -->\n    <script src="/static/jquery.cookie/jquery.cookie.js"></script>\n    <!-- DataTables Javascript -->\n    <script src="/static/datatables.net/js/jquery.dataTables.min.js"></script>\n    <script src="/static/datatables.net-dt/js/dataTables.dataTables.min.js"></script>\n    <script src="/static/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/dataTables.buttons.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/buttons.html5.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/buttons.colVis.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/buttons.print.min.js"></script>\n    <script src="/static/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>\n    <script src="/static/datatables.net-colreorder/js/dataTables.colReorder.min.js"></script>\n\n    <script src="/static/pdfmake/build/pdfmake.min.js"></script>\n    <script src="/static/pdfmake/build/vfs_fonts.js"></script>\n\n    <script src="/static/jszip/dist/jszip.min.js"></script>\n\n    <!-- Bootstrap Core CSS -->\n    <link href="/static/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">\n\n    <!-- MetisMenu CSS -->\n    <link href="/static/metismenu/dist/metisMenu.min.css" rel="stylesheet">\n\n    <!-- Custom CSS -->\n    <link href="/static/startbootstrap-sb-admin-2/dist/css/sb-admin-2.css" rel="stylesheet">\n\n    <!-- Custom Fonts -->\n    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">\n\n    \n    \n    <link rel="stylesheet" href="/static/components-jqueryui/themes/flick/jquery-ui.min.css">\n    <link rel="shortcut icon" href="/static/dojo/img/favicon.ico"/>\n    <link rel="stylesheet" href="/static/chosen-bootstrap/chosen.bootstrap.min.css">\n    <link rel="stylesheet" href="/static/fullcalendar/dist/fullcalendar.min.css">\n    <link rel="stylesheet" href="/static/dojo/css/dojo.css">\n    <link rel="stylesheet" href="/static/datatables.net-dt/css/jquery.dataTables.min.css">\n    \n    <link rel="stylesheet" href="/static/datatables.net-bs/css/dataTables.bootstrap.min.css">\n    <link rel="stylesheet" href="/static/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">\n\n    <style>\n        \n        \n    </style>\n</head>\n<body class="min">\n\n<div id="wrapper">\n    \n        <!-- Navigation -->\n        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">\n            <div class="navbar-header">\n                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">\n                    <span class="sr-only">Toggle navigation</span>\n                    <span class="icon-bar"></span>\n                    <span class="icon-bar"></span>\n                    <span class="icon-bar"></span>\n                </button>\n                <a class="navbar-brand" href="/">\n                    <img src="/static/dojo/img/logo.png" alt="DefectDojo Logo" width="240"/>\n                </a>\n\n            </div>\n            <!-- /.navbar-header -->\n\n            <ul class="nav navbar-top-links navbar-right">\n                \n                    <li>\n                        <div class="custom-search-form">\n                            <form id="custom_search_form" role="search" method="get" action="/simple_search">\n                                <div class="input-group">\n                                    <input id="simple_search" label="simple_search" aria_label="simple_search" type="text" name="query" class="form-control"\n                                        placeholder="Search..." value="">\n                                    <span class="input-group-btn">\n                                        <button id="simple_search_submit" class="btn btn-primary" type="submit" aria-label="Search">\n                                            <i class="fa fa-search"></i>\n                                        </button>\n                                    </span>\n                                </div>\n                            </form>\n                        </div>\n                        <!-- /input-group -->\n                    </li>\n                    <li class="dropdown">\n                        <a class="dropdown-toggle dropdown-toggle-h6" data-toggle="dropdown" href="#" aria-expanded="false" aria-label="6 Alerts">\n                            <i class="fa fa-bell fa-fw"></i>\n                            <span id="alert_count" class="badge badge-count badge-count6">6</span>\n                            <i class="fa fa-caret-down"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-alerts">\n                        </ul>\n                        <!-- /.dropdown-alerts -->\n                    </li>\n                \n                <li class="dropdown">\n                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false" aria-label="User Menu">\n                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>\n                    </a>\n                    <ul class="dropdown-menu dropdown-user">\n                        \n                            \n                                <li><a href="/profile"><i\n                                        class="fa fa-user fa-fw"></i> admin</a>\n                                </li>\n                                <li><a href="/api/key"><i class="fa fa-fw fa-key"></i> API v1 Key</a></li>\n                                <li><a href="/api/key-v2"><i class="fa fa-fw fa-key"></i> API v2 Key</a></li>\n                            \n                            <li><a href="/api/v1/doc/"><i class="fa fa-book fa-fw"></i> API\n                                v1 Docs</a></li>\n                            <li><a href="/api/v2/doc/"><i class="fa fa-book fa-fw"></i> API\n                                v2 Docs</a></li>\n                            \n                            \n                                <li><a href="/questionnaire"> <i class="fa fa-hospital-o fa-fw"> </i> Questionnaires </a></li>\n                            \n                        \n                        \n                            \n                            <li><a href="/logout"><i class="fa fa-sign-out fa-fw"></i> Logout</a></li>\n                        \n                    </ul>\n                    <!-- /.dropdown-user -->\n                </li>\n                <!-- /.dropdown -->\n            </ul>\n            <!-- /.navbar-top-links -->\n\n            <div class="navbar-default sidebar navbar-fixed-top" role="navigation">\n                <div class="sidebar-nav navbar-collapse">\n                    <ul class="nav" id="side-menu">\n                        \n\n                            \n                                <li>\n                                    <a href="/dashboard" aria-disabled="true" aria-expanded="false" aria-label="Dashboard">\n                                        <i class="fa fa-dashboard fa-fw"></i>\n                                        <span>Dashboard</span>\n                                    </a>\n                                </li>\n                            \n                            <li>\n                                \n                                    <a href="/product" aria-expanded="false" aria-label="Products">\n                                        <i class="fa fa-list fa-fw"></i>\n                                        <span>Products</span>\n                                        <span class="glyphicon arrow"></span>\n                                    </a>\n                                \n                                <ul class="nav nav-second-level">\n                                    \n                                    <li>\n                                        <a href="/product/add"> Add Product</a>\n                                    </li>\n                                    \n                                    <li>\n                                        <a href="/product"> All Products</a>\n                                    </li>\n                                    \n                                    <li>\n                                        <a href="/product/type/add"> Add Product Type</a>\n                                    </li>\n                                    \n                                    <li>\n                                        <a href="/product/type">All Product Types</a>\n                                    </li>\n                                </ul>\n                                <!-- /.nav-second-level -->\n                            </li>\n                            \n                                <li>\n                                    <a href="/engagements_all" aria-expanded="false" aria-label="Engagements">\n                                        <i class="fa fa-inbox fa-fw"></i>\n                                        <span>Engagements</span>\n                                        <span class="glyphicon arrow"></span>\n                                    </a>\n                                    <ul class="nav nav-second-level">\n                                        <li>\n                                            <a href="/engagements_all">All Engagements</a>\n                                        </li>\n                                        <li>\n                                            <a href="/engagement">Active Engagements</a>\n                                        </li>\n                                        <li>\n                                            <a href="/test_type">Test Types</a>\n                                        </li>\n                                        <li>\n                                            <a href="/dev_env">Environments</a>\n                                        </li>\n                                    </ul>\n                                    <!-- /.nav-second-level -->\n                                </li>\n                                <li>\n                                    <a href="/finding/open" aria-expanded="false" aria-label="Findings">\n                                        <i class="fa fa-bug fa-fw"></i>\n                                        <span>Findings</span>\n                                        <span class="glyphicon arrow"></span>\n\t\t\t\t                    </a>\n                                    <ul class="nav nav-second-level">\n                                        <li>\n                                            <a href="/finding/open">Open Findings</a>\n                                        </li>\n                                        <li>\n                                            <a href="/finding">All Findings</a>\n                                        </li>\n                                        <li>\n                                            <a href="/finding/closed">Closed Findings</a>\n                                        </li>\n                                        <li>\n                                            <a href="/finding/accepted">Risk Accepted Findings</a>\n                                        </li>\n                                        <li>\n                                            <a href="/template">Finding Templates</a>\n                                        </li>\n                                    </ul>\n                                    <!-- /.nav-second-level -->\n                                </li>\n                                <li>\n\t\t\t\t                    <a href="/components" id="product_component_view" aria-expanded="false"  aria-label="Components">\n                                        <i class="fa fa-th-large fa-fw"></i>\n                                        <span>Components</span>\n                                    </a>\n                                    <ul class="nav nav-second-level">\n                                        <li>\n                                            <a href="/components">All Components</a>\n                                        </li>\n                                    </ul>\n                                </li>\n                                <li>\n                                    <a href="/endpoint" aria-expanded="false" aria-label="Endpoints">\n\t\t\t\t\t                    <i class="fa fa-sitemap fa-fw"></i>\n                                        <span>Endpoints</span>\n                                        <span class="glyphicon arrow"></span>\n                                    </a>\n                                    <ul class="nav nav-second-level">\n                                        <li>\n                                            <a href="/endpoint">All Endpoints</a>\n                                        </li>\n                                        <li>\n                                            <a href="/endpoint/vulnerable">\n                                                Vulnerable Endpoints\n                                            </a>\n                                        </li>\n                                    </ul>\n                                </li>\n                            \n                            \n                            <li>\n                                <a href="/reports" aria-expanded="false" aria-label="Reports">\n\t\t\t\t                    <i class="fa fa-file-text-o fa-fw"></i>\n                                    <span>Reports</span>\n                                    <span class="glyphicon arrow"></span>\n                                </a>\n                                <ul class="nav nav-second-level">\n                                    <li><a href="/reports"> All Reports </a></li>\n                                    <li><a href="/reports/builder"> Report Builder </a></li>\n                                </ul>\n                                <!-- /.nav-second-level -->\n                            </li>\n                            <li>\n                                <a href="/metrics?date=5&view=dashboard" aria-expanded="false" aria-label="Metrics">\n\t\t\t\t                    <i class="fa fa-bar-chart fa-fw"></i>\n                                    <span>Metrics</span>\n                                    <span class="glyphicon arrow"></span>\n                                </a>\n                                <ul class="nav nav-second-level">\n                                    <li><a href="/critical_product_metrics"> Critical Product Metrics </a></li>\n                                    <li><a href="/metrics/product/type"> Product Type Metrics </a></li>\n                                    <li><a href="/metrics/product/type/counts"> Product Type Counts </a></li>\n                                    <li><a href="/metrics/simple"> Simple Metrics </a></li>\n                                    \n                                        <li><a href="/metrics/engineer"> Engineer Metrics </a></li>\n                                        <li><a href="/metrics/research"> Security Research Metrics </a></li>\n                                    \n                                    <li><a href="/metrics?date=5&view=dashboard"> Metrics Dashboard </a></li>\n                                </ul>\n                                <!-- /.nav-second-level -->\n                            </li>\n                            \n                            \n                                <li>\n                                    <a href="/user" aria-disabled="true" aria-expanded="false" aria-label="Users">\n                                        <i class="fa fa-user fa-fw"></i>\n                                        <span>Users</span>\n                                    </a>\n                                </li>\n                            \n                            \n                                <li>\n\t\t\t\t                    <a href="/calendar/engagements" aria-disabled="true" aria-expanded="false" aria-label="Calendar">\n                                        <i class="fa fa-calendar fa-fw"></i>\n                                        <span>Calendar</span>\n                                    </a>\n                                </li>\n                                <li>\n                                    <a href="#"><i class="fa fa-hospital-o fa-fw"> </i> <span>Questionnaires</span><span\n                                            class="glyphicon arrow"></span></a>\n                                    <ul class="nav nav-second-level">\n                                        <li><a href="/questionnaire">All Questionnaires </a></li>\n                                        <li><a href="/questions">All Questions </a></li>\n\n                                    </ul>\n                                    <!-- /.nav-second-level -->\n                                </li>\n                            \n                                <li id="menu_configuration">\n\t\t\t\t                    <a href="#" aria-expanded="false" aria-label="Configuration">\n                                        <i class="fa fa-cog fa-fw"></i>\n                                        <span>Configuration</span>\n                                    </a>\n                                    <ul class="nav nav-second-level">\n                                        \n                                        <li><a href="/cred">Credential Manager </a></li>\n                                        \n                                        \n                                        <li><a href="/tool_config">Tool Configuration </a></li>\n                                        <li><a href="/tool_type">Tool Type </a></li>\n                                        <li><a href="/rules">Rules Framework </a></li>\n                                        <li><a href="/regulations">Regulations </a></li>\n                                        <li><a href="/system_settings">System Settings </a></li>\n                                        <li><a href="/note_type">Note Types </a></li>\n                                        <li><a href="/configure_google_sheets">Google Sheets Sync</a></li>\n                                        <li><a href="/configure_banner">Login banner</a></li>\n                                        \n                                        <li><a href="/notifications/personal">Notifications</a></li>\n                                    </ul>\n                        \n\n                        <li id="min-menu">\n                            <a href="#" id="minimize-menu" title="Expand/Collapse Menu" aria-label="Expand/Collapse Menu">\n                                <i id="nav-minimize-menu-li" class="fa fa-arrow-circle-right fa-fw"></i>\n                                <span>Collapse Menu</span>\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n                <!-- /.sidebar-collapse -->\n            </div>\n            <!-- /.navbar-static-side -->\n        </nav>\n    \n    <!-- Page Content -->\n    <div id="page-wrapper">\n        <div class="container-fluid">\n            <!-- start of tabs -->\n            \n            <div class="row hidden-xs">\n                <div class="col-lg-12">\n                    \n                        <ul class="breadcrumb main">\n                            \n                                <li class="">\n                                    <a class=""\n                                       href="/">Home</a>\n                                </li>\n                            \n                                <li class="active">\n                                    <a class="active"\n                                       href="/engagements_all">All Engagements</a>\n                                </li>\n                            \n                        </ul>\n                    \n                </div>\n            </div>\n            \n            <!-- end of tabs -->\n            <div class="row">\n                <div class="col-lg-12">\n                    \n                </div>\n                <!-- /.col-lg-12 -->\n            </div>\n            <!-- /.row -->\n            <div class="row">\n                <div id="base-content" class="col-lg-12">\n                    \n\n                    \n\n                    \n\n                    \n\n                    \n\n                    \n    <div class="row" xmlns="http://www.w3.org/1999/html">\n        <div class="col-md-12">\n            <div class="panel panel-default">\n                <div class="panel-heading tight">\n                    <h3 class="has-filters">\n                        Engagements\n                        <div class="dropdown pull-right">\n                            <button id="show-filters" data-toggle="collapse" data-target="#the-filters" class="btn btn-primary toggle-filters"> <i class="fa fa-filter"></i> <i class="caret"></i> </button>\n                        </div>\n                    </h3>\n                </div>\n                <div id="the-filters" class="is-filters panel-body collapse ">\n                    \n\n\n\n    <link rel="stylesheet" href="/static/chosen-bootstrap/chosen.bootstrap.min.css">\n\n\n    <link href="/static/tagulous/lib/select2-4/css/select2.min.css" type="text/css" media="all" rel="stylesheet">\n\n\n    <script type="text/javascript" src="/static/tagulous/lib/select2-4/js/select2.full.min.js"></script>\n<script type="text/javascript" src="/static/tagulous/tagulous.js"></script>\n<script type="text/javascript" src="/static/tagulous/adaptor/select2-4.js"></script>\n\n<div class="filter-set">\n    <form method="get"  class="engagements_all-filters form-inline dojo-filter-set">\n        \n        \n            <div class="form-group">\n                \n                <label for="id_name" style="display: block;">Name contains</label>\n                \n                    <input type="text" name="name" placeholder="Name contains" class="form-control input-sm" id="id_name">\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_prod_type" style="display: block;">Product Type</label>\n                \n                    <select name="prod_type" placeholder="Product Type" class="form-control input-sm" id="id_prod_type" multiple>\n  <option value="1">books</option>\n\n  <option value="2">ebooks</option>\n\n  <option value="3">podcast</option>\n\n</select>\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_engagement__lead" style="display: block;">Lead</label>\n                \n                    <select name="engagement__lead" placeholder="Lead" class="form-control input-sm" id="id_engagement__lead">\n  <option value="" selected>---------</option>\n\n  <option value="1">(admin)</option>\n\n  <option value="2">(user1)</option>\n\n</select>\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_engagement__version" style="display: block;">Engagement version</label>\n                \n                    <input type="text" name="engagement__version" placeholder="Engagement version" class="form-control input-sm" id="id_engagement__version">\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_engagement__test__version" style="display: block;">Test version</label>\n                \n                    <input type="text" name="engagement__test__version" placeholder="Test version" class="form-control input-sm" id="id_engagement__test__version">\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_engagement__status" style="display: block;">Status</label>\n                \n                    <select name="engagement__status" placeholder="Status" class="form-control input-sm" id="id_engagement__status" multiple>\n  <option value="Not Started">Not Started</option>\n\n  <option value="Blocked">Blocked</option>\n\n  <option value="Cancelled">Cancelled</option>\n\n  <option value="Completed">Completed</option>\n\n  <option value="In Progress">In Progress</option>\n\n  <option value="On Hold">On Hold</option>\n\n  <option value="Waiting for Resource">Waiting for Resource</option>\n\n</select>\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_tags" style="display: block;">Tags</label>\n                \n                    <input type="text" name="tags" placeholder="Tags" class="form-control input-sm" id="id_tags" data-tag-list="[]" data-tag-options="{&quot;force_lowercase&quot;: true, &quot;autocomplete_settings&quot;: {&quot;placeholder&quot;: &quot;Enter some tags (comma separated, use enter to select / create a new tag)&quot;, &quot;width&quot;: &quot;200px&quot;, &quot;defer&quot;: true}, &quot;required&quot;: false}" data-tagulous="true" autocomplete="off">\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_tag" style="display: block;">Tag name contains</label>\n                \n                    <input type="text" name="tag" placeholder="Tag name contains" class="form-control input-sm" id="id_tag">\n                \n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_o" style="display: block;">Ordering</label>\n                \n                    <select name="o" ="" class="form-control input-sm" id="id_o">\n  <option value="" selected>---------</option>\n\n  <option value="name">Product Name</option>\n\n  <option value="-name">Product Name (descending)</option>\n\n  <option value="prod_type__name">Product Type</option>\n\n  <option value="-prod_type__name">Product Type (descending)</option>\n\n</select>\n                \n            </div>\n        \n        \n            <div class="inline-block" style="vertical-align: text-top">\n                <button id="apply" class="btn btn-sm btn-primary">\n                    <i class="fa fa-filter"></i> Apply Filters\n                </button>\n                &nbsp;\n                \n                    <a href="/engagements_all" id="clear" class="clear centered"> [Clear Filters] </a>\n                \n                \n            </div>\n        \n    </form>\n\n</div>\n\n                </div>\n            </div>\n            \n\n                <div class="clearfix">\n                    \n\n\n<div class="pull-left pagination  pagination-sm">\n    Showing entries 1 to 2 of 2\n</div>\n\n<nav class="pull-right">\n    <ul class="pagination pagination-sm">\n            \n            \n                <li>\n                    <!-- Split button -->\n                    &nbsp;\n                    <div class="btn-group">\n                        <button type="button" class="btn btn-sm btn-primary">Page Size</button>\n                        <button type="button" class="btn-sm btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                            <span class="caret"></span>\n                            <span class="sr-only">Toggle Dropdown</span>\n                        </button>\n                        <ul class="dropdown-menu">\n                            <li><a href="?page_size=25">25</a></li>\n                            <li><a href="?page_size=50">50</a></li>\n                            <li><a href="?page_size=75">75</a></li>\n                            <li><a href="?page_size=100">100</a></li>\n                            <li><a href="?page_size=150">150</a></li>\n                            \n                            <li><a href="?page_size=2">All</a></li>\n                        </ul>\n                    </div>\n                </li>\n            \n        </ul>\n\n    </nav>\n    \n    \n\n                </div>\n\n                <div class="table-responsive panel panel-default">\n                    <table id="engagements" class="tablesorter-bootstrap table table-bordered table-condensed table-striped table-hover">\n                        <thead>\n                        <tr>\n                            <th>Product</th>\n                            <th>Product Type</th>\n                            <th>Engagement Name</th>\n                            \n                            <th>Status</th>\n                            <th>Period</th>\n                            <th>Lead</th>\n                            <th>Tests</th>\n                            \n                                <th>Engagement</th>\n                            \n                        </tr>\n                        </thead>\n\n                        <tbody>\n                        \n                            \n                                <tr>\n\n                                    <td class="prod_name"><a href="/product/1">Python How-to</a>\n                                        <sup>\n                                            \n                                        </sup>\n                                    </td>\n                                    <td class="prod_name">\n                                        <a href="/metrics/product/type/1">books</a>\n                                    </td>\n                                    <td>\n                                        <a style="display: inline" class="eng_link"\n                                           href="/engagement/2">\n                                            April monthly engagement \n                                        </a>\n                                        <sup>\n                                            \n                                        </sup>\n                                        <br>\n                                    </td>\n                                    \n                                    <td> Completed </td>\n                                    <td> 04/12/2018 - 04/12/2018\n                                        <sup><div class="tag-label warning-color">2 years 10 months 5 days  overdue</div></sup>\n                                        \n                                    </td>\n                                    <td> </td>\n                                    <td> \n                                        \n                                            <a href="/test/13"> ZAP Scan:  ()</a>\n                                        \n                                        <br>\n                                    \n                                    </td>\n                                    \n                                        <td>\n                                            <a class="btn btn-sm btn-success" href="/product/1/new_engagement">\n                                                <i class="fa fa-plus"></i> Add\n                                            </a>\n                                        </td>\n                                    \n                                </tr>\n\n                            \n                        \n                            \n                                <tr>\n\n                                    <td class="prod_name"><a href="/product/2">Security How-to</a>\n                                        <sup>\n                                            \n                                        </sup>\n                                    </td>\n                                    <td class="prod_name">\n                                        <a href="/metrics/product/type/2">ebooks</a>\n                                    </td>\n                                    <td>\n                                        <a style="display: inline" class="eng_link"\n                                           href="/engagement/1">\n                                            1st Quarter Engagement \n                                        </a>\n                                        <sup>\n                                            \n                                        </sup>\n                                        <br>\n                                    </td>\n                                    \n                                    <td> In Progress </td>\n                                    <td> 04/12/2018 - 04/12/2018\n                                        <sup><div class="tag-label warning-color">2 years 10 months 5 days  overdue</div></sup>\n                                        \n                                    </td>\n                                    <td> </td>\n                                    <td> \n                                        \n                                            <a href="/test/3"> ZAP Scan ()</a>\n                                        \n                                        <br>\n                                    \n                                        \n                                            <a href="/test/14"> ZAP Scan ()</a>\n                                        \n                                        <br>\n                                    \n                                    </td>\n                                    \n                                        <td>\n                                            <a class="btn btn-sm btn-success" href="/product/2/new_engagement">\n                                                <i class="fa fa-plus"></i> Add\n                                            </a>\n                                        </td>\n                                    \n                                </tr>\n\n                            \n                                <tr>\n\n                                    <td class="prod_name"><a href="/product/2">Security How-to</a>\n                                        <sup>\n                                            \n                                        </sup>\n                                    </td>\n                                    <td class="prod_name">\n                                        <a href="/metrics/product/type/2">ebooks</a>\n                                    </td>\n                                    <td>\n                                        <a style="display: inline" class="eng_link"\n                                           href="/engagement/4">\n                                            April monthly engagement \n                                        </a>\n                                        <sup>\n                                            \n                                        </sup>\n                                        <br>\n                                    </td>\n                                    \n                                    <td> Completed </td>\n                                    <td> 04/12/2018 - 04/12/2018\n                                        <sup><div class="tag-label warning-color">2 years 10 months 5 days  overdue</div></sup>\n                                        \n                                    </td>\n                                    <td> </td>\n                                    <td> \n                                        \n                                            <a href="/test/4"> ZAP Scan ()</a>\n                                        \n                                        <br>\n                                    \n                                    </td>\n                                    \n                                        <td>\n                                            <a class="btn btn-sm btn-success" href="/product/2/new_engagement">\n                                                <i class="fa fa-plus"></i> Add\n                                            </a>\n                                        </td>\n                                    \n                                </tr>\n\n                            \n                                <tr>\n\n                                    <td class="prod_name"><a href="/product/2">Security How-to</a>\n                                        <sup>\n                                            \n                                        </sup>\n                                    </td>\n                                    <td class="prod_name">\n                                        <a href="/metrics/product/type/2">ebooks</a>\n                                    </td>\n                                    <td>\n                                        <a style="display: inline" class="eng_link"\n                                           href="/engagement/5">\n                                            April monthly engagement \n                                        </a>\n                                        <sup>\n                                            \n                                        </sup>\n                                        <br>\n                                    </td>\n                                    \n                                    <td> Completed </td>\n                                    <td> 04/12/2018 - 04/12/2018\n                                        <sup><div class="tag-label warning-color">2 years 10 months 5 days  overdue</div></sup>\n                                        \n                                    </td>\n                                    <td> </td>\n                                    <td> \n                                        \n                                            <a href="/test/55"> Checkmarx Scan detailed ()</a>\n                                        \n                                        <br>\n                                    \n                                        \n                                            <a href="/test/66"> Checkmarx Scan detailed ()</a>\n                                        \n                                        <br>\n                                    \n                                        \n                                            <a href="/test/77"> Veracode Scan ()</a>\n                                        \n                                        <br>\n                                    \n                                        \n                                            <a href="/test/88"> Veracode Scan ()</a>\n                                        \n                                        <br>\n                                    \n                                    </td>\n                                    \n                                        <td>\n                                            <a class="btn btn-sm btn-success" href="/product/2/new_engagement">\n                                                <i class="fa fa-plus"></i> Add\n                                            </a>\n                                        </td>\n                                    \n                                </tr>\n\n                            \n                                <tr>\n\n                                    <td class="prod_name"><a href="/product/2">Security How-to</a>\n                                        <sup>\n                                            \n                                        </sup>\n                                    </td>\n                                    <td class="prod_name">\n                                        <a href="/metrics/product/type/2">ebooks</a>\n                                    </td>\n                                    <td>\n                                        <a style="display: inline" class="eng_link"\n                                           href="/engagement/6">\n                                            April monthly engagement \n                                        </a>\n                                        <sup>\n                                            \n                                        </sup>\n                                        <br>\n                                    </td>\n                                    \n                                    <td> Completed </td>\n                                    <td> 04/12/2018 - 04/12/2018\n                                        <sup><div class="tag-label warning-color">2 years 10 months 5 days  overdue</div></sup>\n                                        \n                                    </td>\n                                    <td> </td>\n                                    <td> \n                                    </td>\n                                    \n                                        <td>\n                                            <a class="btn btn-sm btn-success" href="/product/2/new_engagement">\n                                                <i class="fa fa-plus"></i> Add\n                                            </a>\n                                        </td>\n                                    \n                                </tr>\n\n                            \n                                <tr>\n\n                                    <td class="prod_name"><a href="/product/2">Security How-to</a>\n                                        <sup>\n                                            \n                                        </sup>\n                                    </td>\n                                    <td class="prod_name">\n                                        <a href="/metrics/product/type/2">ebooks</a>\n                                    </td>\n                                    <td>\n                                        <a style="display: inline" class="eng_link"\n                                           href="/engagement/3">\n                                            weekly engagement \n                                        </a>\n                                        <sup>\n                                            \n                                        </sup>\n                                        <br>\n                                    </td>\n                                    \n                                    <td> Completed </td>\n                                    <td> 04/03/2018 - 04/04/2018\n                                        <sup><div class="tag-label warning-color">2 years 10 months 13 days  overdue</div></sup>\n                                        \n                                    </td>\n                                    <td> </td>\n                                    <td> \n                                        \n                                            <a href="/test/33"> Generic Findings Import ()</a>\n                                        \n                                        <br>\n                                    \n                                    </td>\n                                    \n                                        <td>\n                                            <a class="btn btn-sm btn-success" href="/product/2/new_engagement">\n                                                <i class="fa fa-plus"></i> Add\n                                            </a>\n                                        </td>\n                                    \n                                </tr>\n\n                            \n                        \n                        </tbody>\n                    </table>\n                </div>\n                <div class="clearfix">\n                    \n\n\n<div class="pull-left pagination  pagination-sm">\n    Showing entries 1 to 2 of 2\n</div>\n\n<nav class="pull-right">\n    <ul class="pagination pagination-sm">\n            \n            \n                <li>\n                    <!-- Split button -->\n                    &nbsp;\n                    <div class="btn-group">\n                        <button type="button" class="btn btn-sm btn-primary">Page Size</button>\n                        <button type="button" class="btn-sm btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                            <span class="caret"></span>\n                            <span class="sr-only">Toggle Dropdown</span>\n                        </button>\n                        <ul class="dropdown-menu">\n                            <li><a href="?page_size=25">25</a></li>\n                            <li><a href="?page_size=50">50</a></li>\n                            <li><a href="?page_size=75">75</a></li>\n                            <li><a href="?page_size=100">100</a></li>\n                            <li><a href="?page_size=150">150</a></li>\n                            \n                            <li><a href="?page_size=2">All</a></li>\n                        </ul>\n                    </div>\n                </li>\n            \n        </ul>\n\n    </nav>\n    \n    \n\n                </div>\n            \n        </div>\n    </div>\n\n                </div>\n                <!-- /.col-lg-12 -->\n            </div>\n        </div>\n        <!-- /.container-fluid -->\n    </div>\n    <!-- /#page-wrapper -->\n    <footer class="footer">\n        <div class="container">\n            <div class="row">\n                <div class="col-md-12 text-center text-">\n                    <p>\n                        <a href="/"><img class="logo" src="/static/dojo/img/chop.png"\n                                                        alt="DefectDojo Chop" height="45"/></a><br/>\n                        v. 1.13.0-dev ( 7477c9d5 )\n                    </p>\n                    <p>\n                        Detailed DefectDojo documentation can be found at  <a\n                            href="http://defectdojo.readthedocs.io/">Read The Docs</a>.\n                    </p>\n                    <p>\n                        DefectDojo is licensed under the <a\n                            href="https://github.com/DefectDojo/django-DefectDojo/blob/master/LICENSE.md">Simplified BSD\n                        license</a>.\n                    </p>\n                    <p>\n                        &copy; 2021 DefectDojo\n                    </p>\n                </div>\n            </div>\n        </div>\n        <p id="alert_refresh" class="hidden">True</p>\n        <p id="disable_count" class="hidden">False</p>\n    </footer>\n</div>\n\n<!-- /#wrapper -->\n\n<!-- our JS -->\n<script src="/static/dojo/js/index.js"></script>\n\n<!-- our CVSS stuff -->\n<script src="/static/dojo/js/cvsscalc30_helptext.js"></script>\n<script src="/static/dojo/js/cvsscalc30.js"></script>\n<script src="/static/dojo/js/cvss_calculator.js"></script>\n<script type="application/javascript">\n    $(document).ready(function() {\n        disable_count = document.getElementById(\'disable_count\').innerHTML\n        refresh = document.getElementById(\'alert_refresh\').innerHTML\n\n        $(\'.has-popover\').popover({\'trigger\':\'hover\'});\n        \n            $(\'.dropdown-toggle\').click(function() {\n                if (disable_count == "False" || refresh == \'True\') {\n                    get_alerts();\n                }\n            });\n\n            if (disable_count == "False") {\n                if(refresh == \'True\') {\n                    setInterval(function() {\n                        update_alertcount();\n                    }, 10000);\n                } else {\n                    update_alertcount();\n                }\n            }\n        \n\n        function update_alertcount() {\n            $.get("/alerts/count", function (data) {\n                if (data.count != $(\'#alert_count\').text()) {\n                    $(\'#alert_count\').text(data.count);\n                    $(\'#alert_count\').removeClass().addClass(\'badge badge-count badge-count\' + data.count);\n                }\n            });\n        }\n\n        function htmlEscape(str) {\n          return str\n            .replace(/\\n/g, " ")\n            .replace(/&/g, \'&amp;\')\n            .replace(/"/g, \'&quot;\')\n            .replace(/\'/g, \'&#39;\')\n            .replace(/</g, \'&lt;\')\n            .replace(/>/g, \'&gt;\');\n        }\n\n        function get_alerts() {\n            $(\'.dropdown-alerts\').html(\'<div class="text-center"><i class="fa fa-spin fa-spinner"></i></div>\');\n            $.get("/alerts/json?limit=12", function (data) {\n                $(\'.dropdown-alerts\').empty();\n                $.each(data, function(i, elem) {\n                  var titleField = elem.fields.title ? elem.fields.title : elem.fields.description;\n                  var display_title = titleField.length < 50 ? titleField : jQuery.trim(titleField).substring(0,50).trim(this) + \'...\';\n                  var description = elem.fields.description\n                  var display_description = description ? description.length < 100 ? description : jQuery.trim(description).substring(0,100).trim(this) + \'...\': \'\'\n                  var dropdown_alert = "alert-list" + i;\n                  $(\'.dropdown-alerts\').append(\'<li><div style="padding: 3px 20px;"><i class="fa fa-\' + htmlEscape(elem.fields.icon) +\n                                                \' fa-fw"></i><a href="\' + htmlEscape(elem.fields.url) + \'" id=\' + dropdown_alert +\n                                                \' title="\' + htmlEscape(display_description) + \'"></a><span class="pull-right text-muted small">\' +\n                                               htmlEscape(elem.fields.source) + \'</span></div></li><li class="divider"></li>\');\n                  $("#" + dropdown_alert).text(display_title);\n                });\n                $(\'.dropdown-alerts\').append(\'<li><a class="text-center" href="/alerts"><strong>See All Alerts </strong>\' +\n                                             \'<i class="fa fa-angle-right"></i></a></li>\');\n                $(\'.dropdown-alerts\').append(\'<li><a class="text-center" href="/delete_alerts"><strong>Clear All Alerts </strong>\' +\n                                           \'<i class="fa fa-angle-right"></i></a></li>\');\n            });\n        }\n\n        $("#id_jiraform-jira_issue").on(\'paste\', function(e) {\n            var clipboardData = e.clipboardData || e.originalEvent.clipboardData || window.clipboardData;\n            var pastedData = clipboardData.getData(\'text\');\n\n            $this = $(this)\n            // if someone entered/pasted a full URL, we strip evertyhing until last \'/\'\n            setTimeout(function (elem) {\n                $this.val($this.val().substring($this.val().lastIndexOf("/") + 1));\n            }, 100);\n        });\n\n        <!-- TODO not working with django tagulous which uses select2, break styling -->\n        <!-- $(\'#id_tags\').select2({ -->\n            <!-- \'placeholder\': \'Select or add some tags...\', -->\n            <!-- \'no_results_text\': "Tag not found, press TAB key to add.", -->\n        <!-- }); -->\n\n    });\n</script>\n\n\n\n    <script>\n        $(function () {\n            var availableTags = [\n                \n                    "Python How-to",\n                \n                    "Security How-to",\n                \n            ];\n            var engWords = [\n                \n                    "1st Quarter Engagement",\n                \n                    "April monthly engagement",\n                \n                    "weekly engagement",\n                \n            ];\n            $("#id_name").autocomplete({\n                source: availableTags\n            });\n            $("#id_engagement__name").autocomplete({\n                source: engWords\n            });\n        });\n    </script>\n    <script>\n        // DataTables setup\n        $(document).ready(function() {\n            date =  new Date().toISOString().slice(0, 10);\n            var fileDated = \'Engagements_List_\' + date;\n            var buttonCommon = {\n                exportOptions: {\n                    columns: \':not(:eq(7))\',\n                    stripHtml: true,\n                    stripNewlines: true,\n                    trim: true,\n                    orthogonal: \'export\'\n                },\n                filename: fileDated,\n                title: \'Engagements List\'\n            };\n\n            // Mapping of table columns to objects for proper cleanup and data formatting\n            var dojoTable = $(\'#engagements\').DataTable({\n                colReorder: true,\n                columnDefs: [\n                    {\n                        "orderable": false,\n                        "targets": [0]\n                    },\n                ],\n                dom: \'Bfrtip\',\n                paging: false,\n                info: false,\n                buttons: [\n                    {\n                        extend: \'colvis\',\n                        columns: \':not(.noVis)\'\n                    },\n                    $.extend( true, {}, buttonCommon, {\n                        extend: \'copy\'\n                    }),\n                    $.extend( true, {}, buttonCommon, {\n                        extend: \'excel\',\n                        autoFilter: true,\n                        sheetName: \'Exported data\',\n                    }),\n                    $.extend( true, {}, buttonCommon, {\n                        extend: \'csv\'\n                    }),\n                    $.extend( true, {}, buttonCommon, {\n                        extend: \'pdf\',\n                        orientation: \'landscape\',\n                        pageSize: \'LETTER\'\n                    }),\n                    $.extend( true, {}, buttonCommon, {\n                        extend: \'print\'\n                    }),\n                ],\n            });\n        });\n    </script>\n    \n<script type="application/javascript" src="/static/chosen-js/chosen.jquery.min.js"></script>\n<script type="application/javascript">\n    $(function () {\n        $(function () {\n\n        })\n\n        $(function () {\n            $(\'.similar-filters select[multiple]\').not(\'[data-tagulous]\').each(function () {\n                $(this).select2(\n                )\n            })\n            $(\'input[data-tagulous]\').each(function () {\n                Tagulous.select2($(this))\n            })\n        })\n\n\n        $(\'.toggle-filters\').on(\'click\', function () {\n            $(this).toggleClass("dropup");\n        })\n\n        <!-- what works on every other page with the \'e\' keydown, conflicts here with the input fields in the filter div, stoppropagation \'fixes\' this -->\n        $(\'.is-filters\').keydown( function(e) {\n            e.stopPropagation();\n        })\n\n        $(\'#clear_js\').on(\'click\', function() {\n            clear_form($(this).closest(\'form\'))\n        })\n    })\n\n    \n\n    \n</script>\n\n</body>\n\n</html>\n')
