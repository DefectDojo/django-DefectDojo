{% extends "base.html" %}
{% load authorization_tags %}
{% load i18n %}
{% load static %}
{% block add_styles %}
  .embed-responsive .embed-responsive-item,
  .embed-responsive iframe { height: 100%;}
{% endblock %}
{% block content %}
  {{block.super }}
  <div class="embed-responsive embed-responsive-16by9">
    <iframe
      class="embed-responsive-item"
      src="{{url}}"
      frameborder="0"
      allowfullscreen
    ></iframe>
  </div>
  <hr />
  {% endblock %} {% block postscript %} {{ block.super }}
  <script type="text/javascript">
    const channel = new MessageChannel();
    const iframe = document.querySelector("iframe");
    iframe.onload = () => {
      iframe.contentWindow.postMessage(
        { action: "all_findings" },
        "{{url}}",
        [channel.port2]
      );
      setTimeout(() => {
        channel.port1.start();
        channel.port1.onmessage = (event) => {
          if (event.data.action === "all_findings") {
            setTimeout(() => {
              iframe.contentWindow.postMessage({
                action: "all_findings",
                data: {
                  csrf_token: "{{ csrf_token }}",
                  sessionid: "{{ sessionid }}",
                  product_id: "{{ product_id }}",
                },
              });
            }, 100);
          }
        };
      }, 100);
    };
  </script>
{% endblock %}
