from datetime import datetime, timezone
from unittest.mock import patch
import random

from django.test import Client, TestCase, override_settings
from django.urls import reverse

from dojo import models


class MetricsViewTest(TestCase):
    fixtures = ['dojo_testdata.json']

    def setUp(self):
        self.client = Client()
        user = models.User.objects.get(username='user1')
        self.client.force_login(user)

    @override_settings(FOOTER_VERSION='unit tests')
    @patch('git.Repo')
    @patch('django.utils.timezone.now')
    def test_query_count(self, mock_timezone, git_repo):
        # Mock the return value for `django.utils.timezone.now`
        mock_datetime = datetime(2010, 1, 1, tzinfo=timezone.utc)
        mock_timezone.return_value = mock_datetime

        # Mock the git repo to something that will throw an exception,
        # triggering release mode.
        git_repo.return_value = None

        # With the test data, assert on expected query count.
        with self.assertNumQueries(51):
            response = self.client.get(reverse('metrics'))
            self.assertEqual(response.status_code, 200)
            # Confirm that the HTML hasn't changed from the baseline, as it
            # existed before query optimization work.
            expected_content = b'\n\n\n<!DOCTYPE html>\n<html lang="en">\n\n<head>\n\n    <meta charset="utf-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <meta name="description" content="">\n    <meta name="author" content="">\n    <title>\n        \n            \n                Product Type Metrics by Findings |\n            \n        \n        DefectDojo\n    </title>\n    \n    \n\n    <!-- jQuery -->\n    <script src="/static/jquery/dist/jquery.js"></script>\n    <!--  jQuery UI -->\n    <script src="/static/components-jqueryui/jquery-ui.min.js"></script>\n    <!-- Bootstrap Core JavaScript -->\n    <script src="/static/bootstrap/dist/js/bootstrap.min.js"></script>\n\n    <!-- Metis Menu Plugin JavaScript -->\n    <script src="/static/metismenu/dist/metisMenu.min.js"></script>\n\n    <script src="/static/chosen-js/chosen.jquery.min.js"></script>\n\n    <!-- Custom Theme JavaScript -->\n    <script src="/static/startbootstrap-sb-admin-2/dist/js/sb-admin-2.js"></script>\n    <!-- Calendar JavaScript -->\n    <script src="/static/moment/min/moment.min.js"></script>\n    <script src="/static/fullcalendar/dist/fullcalendar.min.js"></script>\n    <!-- jquery cookie -->\n    <script src="/static/jquery.cookie/jquery.cookie.js"></script>\n    <!-- DataTables Javascript -->\n    <script src="/static/datatables.net/js/jquery.dataTables.min.js"></script>\n    <script src="/static/datatables.net-dt/js/dataTables.dataTables.min.js"></script>\n    <script src="/static/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/dataTables.buttons.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/buttons.html5.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/buttons.colVis.min.js"></script>\n    <script src="/static/datatables.net-buttons/js/buttons.print.min.js"></script>\n    <script src="/static/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>\n    <script src="/static/datatables.net-colreorder/js/dataTables.colReorder.min.js"></script>\n\n    <script src="/static/pdfmake/build/pdfmake.min.js"></script>\n    <script src="/static/pdfmake/build/vfs_fonts.js"></script>\n\n    <script src="/static/jszip/dist/jszip.min.js"></script>\n\n    <!-- Bootstrap Core CSS -->\n    <link href="/static/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">\n\n    <!-- MetisMenu CSS -->\n    <link href="/static/metismenu/dist/metisMenu.min.css" rel="stylesheet">\n\n    <!-- Custom CSS -->\n    <link href="/static/startbootstrap-sb-admin-2/dist/css/sb-admin-2.css" rel="stylesheet">\n\n    <!-- Custom Fonts -->\n    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">\n\n    \n    \n    <link rel="stylesheet" href="/static/components-jqueryui/themes/flick/jquery-ui.min.css">\n    <link rel="shortcut icon" href="/static/dojo/img/favicon.ico"/>\n    <link rel="stylesheet" href="/static/chosen-bootstrap/chosen.bootstrap.min.css">\n    <link rel="stylesheet" href="/static/fullcalendar/dist/fullcalendar.min.css">\n    <link rel="stylesheet" href="/static/dojo/css/dojo.css">\n    <link rel="stylesheet" href="/static/datatables.net-dt/css/jquery.dataTables.min.css">\n    \n    <link rel="stylesheet" href="/static/datatables.net-bs/css/dataTables.bootstrap.min.css">\n    <link rel="stylesheet" href="/static/datatables.net-buttons-bs/css/buttons.bootstrap.min.css">\n\n    <style>\n        \n    .tabs-below > .nav-tabs,\n    .tabs-right > .nav-tabs,\n    .tabs-left > .nav-tabs {\n    border-bottom: 0;\n    }\n\n    .tab-content > .tab-pane,\n    .pill-content > .pill-pane {\n    display: none;\n    }\n\n    .tab-content > .active,\n    .pill-content > .active {\n    display: block;\n    }\n\n    .tabs-below > .nav-tabs {\n    border-top: 1px solid #ddd;\n    }\n\n    .tabs-below > .nav-tabs > li {\n    margin-top: -1px;\n    margin-bottom: 0;\n    }\n\n    .tabs-below > .nav-tabs > li > a {\n    -webkit-border-radius: 0 0 4px 4px;\n    -moz-border-radius: 0 0 4px 4px;\n    border-radius: 0 0 4px 4px;\n    }\n\n    .tabs-below > .nav-tabs > li > a:hover,\n    .tabs-below > .nav-tabs > li > a:focus {\n    border-top-color: #ddd;\n    border-bottom-color: transparent;\n    }\n\n    .tabs-below > .nav-tabs > .active > a,\n    .tabs-below > .nav-tabs > .active > a:hover,\n    .tabs-below > .nav-tabs > .active > a:focus {\n    border-color: transparent #ddd #ddd #ddd;\n    }\n\n    .tabs-left > .nav-tabs > li,\n    .tabs-right > .nav-tabs > li {\n    float: none;\n    }\n\n    .tabs-left > .nav-tabs > li > a,\n    .tabs-right > .nav-tabs > li > a {\n    min-width: 74px;\n    margin-right: 0;\n    margin-bottom: 3px;\n    }\n\n    .tabs-left > .nav-tabs {\n    float: left;\n    margin-right: 19px;\n    border-right: 1px solid #ddd;\n    }\n\n    .tabs-left > .nav-tabs > li > a {\n    margin-right: -1px;\n    -webkit-border-radius: 4px 0 0 4px;\n    -moz-border-radius: 4px 0 0 4px;\n    border-radius: 4px 0 0 4px;\n    }\n\n    .tabs-left > .nav-tabs > li > a:hover,\n    .tabs-left > .nav-tabs > li > a:focus {\n    border-color: #eeeeee #dddddd #eeeeee #eeeeee;\n    }\n\n    .tabs-left > .nav-tabs .active > a,\n    .tabs-left > .nav-tabs .active > a:hover,\n    .tabs-left > .nav-tabs .active > a:focus {\n    border-color: #ddd transparent #ddd #ddd;\n    *border-right-color: #ffffff;\n    }\n\n    .tabs-right > .nav-tabs {\n    float: right;\n    margin-left: 19px;\n    border-left: 1px solid #ddd;\n    }\n\n    .tabs-right > .nav-tabs > li > a {\n    margin-left: -1px;\n    -webkit-border-radius: 0 4px 4px 0;\n    -moz-border-radius: 0 4px 4px 0;\n    border-radius: 0 4px 4px 0;\n    }\n\n    .tabs-right > .nav-tabs > li > a:hover,\n    .tabs-right > .nav-tabs > li > a:focus {\n    border-color: #eeeeee #eeeeee #eeeeee #dddddd;\n    }\n\n    .tabs-right > .nav-tabs .active > a,\n    .tabs-right > .nav-tabs .active > a:hover,\n    .tabs-right > .nav-tabs .active > a:focus {\n    border-color: #ddd #ddd #ddd transparent;\n    *border-left-color: #ffffff;\n    }\n\n    #chart_div, #chart_div5, #chart_div2, #chart_div3, #chart_div4 {height: 300px}\n\n    </style>\n</head>\n<body class="min">\n\n<div id="wrapper">\n    \n        <!-- Navigation -->\n        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">\n            <div class="navbar-header">\n                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">\n                    <span class="sr-only">Toggle navigation</span>\n                    <span class="icon-bar"></span>\n                    <span class="icon-bar"></span>\n                    <span class="icon-bar"></span>\n                </button>\n                <a class="navbar-brand" href="/">\n                    <img src="/static/dojo/img/logo.png" alt="DefectDojo Logo" width="240"/>\n                </a>\n\n            </div>\n            <!-- /.navbar-header -->\n\n            <ul class="nav navbar-top-links navbar-right">\n                \n                    <li>\n                        <div class="custom-search-form">\n                            <form id="custom_search_form" role="search" method="get" action="/simple_search">\n                                <div class="input-group">\n                                    <input id="simple_search" label="simple_search" aria_label="simple_search" type="text" name="query" class="form-control"\n                                        placeholder="Search..." value="">\n                                    <span class="input-group-btn">\n                                        <button id="simple_search_submit" class="btn btn-primary" type="submit" aria-label="Search">\n                                            <i class="fa fa-search"></i>\n                                        </button>\n                                    </span>\n                                </div>\n                            </form>\n                        </div>\n                        <!-- /input-group -->\n                    </li>\n                    <li class="dropdown">\n                        <a class="dropdown-toggle dropdown-toggle-h0" data-toggle="dropdown" href="#" aria-expanded="false" aria-label="0 Alerts">\n                            <i class="fa fa-bell fa-fw"></i>\n                            <span id="alert_count" class="badge badge-count badge-count0">0</span>\n                            <i class="fa fa-caret-down"></i>\n                        </a>\n                        <ul class="dropdown-menu dropdown-alerts">\n                        </ul>\n                        <!-- /.dropdown-alerts -->\n                    </li>\n                \n                <li class="dropdown">\n                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false" aria-label="User Menu">\n                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>\n                    </a>\n                    <ul class="dropdown-menu dropdown-user">\n                        \n                            \n                                <li><a href="/profile"><i\n                                        class="fa fa-user fa-fw"></i> user1</a>\n                                </li>\n                                <li><a href="/api/key"><i class="fa fa-fw fa-key"></i> API v1 Key</a></li>\n                                <li><a href="/api/key-v2"><i class="fa fa-fw fa-key"></i> API v2 Key</a></li>\n                            \n                            <li><a href="/api/v1/doc/"><i class="fa fa-book fa-fw"></i> API\n                                v1 Docs</a></li>\n                            <li><a href="/api/v2/doc/"><i class="fa fa-book fa-fw"></i> API\n                                v2 Docs</a></li>\n                            \n                            \n                        \n                        \n                            \n                            <li><a href="/logout"><i class="fa fa-sign-out fa-fw"></i> Logout</a></li>\n                        \n                    </ul>\n                    <!-- /.dropdown-user -->\n                </li>\n                <!-- /.dropdown -->\n            </ul>\n            <!-- /.navbar-top-links -->\n\n            <div class="navbar-default sidebar navbar-fixed-top" role="navigation">\n                <div class="sidebar-nav navbar-collapse">\n                    <ul class="nav" id="side-menu">\n                        \n\n                            \n                            <li>\n                                \n                                <a href="/product" title="Products" aria-label="Products"><i class="fa fa-list fa-fw"></i><span>Products</span></a>\n                                \n                                \n                                <!-- /.nav-second-level -->\n                            </li>\n                            \n                            \n                            <li>\n                                <a href="/reports" aria-expanded="false" aria-label="Reports">\n\t\t\t\t                    <i class="fa fa-file-text-o fa-fw"></i>\n                                    <span>Reports</span>\n                                    <span class="glyphicon arrow"></span>\n                                </a>\n                                <ul class="nav nav-second-level">\n                                    <li><a href="/reports"> All Reports </a></li>\n                                    <li><a href="/reports/builder"> Report Builder </a></li>\n                                </ul>\n                                <!-- /.nav-second-level -->\n                            </li>\n                            <li>\n                                <a href="/metrics?date=5&view=dashboard" aria-expanded="false" aria-label="Metrics">\n\t\t\t\t                    <i class="fa fa-bar-chart fa-fw"></i>\n                                    <span>Metrics</span>\n                                    <span class="glyphicon arrow"></span>\n                                </a>\n                                <ul class="nav nav-second-level">\n                                    <li><a href="/critical_product_metrics"> Critical Product Metrics </a></li>\n                                    <li><a href="/metrics/product/type"> Product Type Metrics </a></li>\n                                    <li><a href="/metrics/product/type/counts"> Product Type Counts </a></li>\n                                    <li><a href="/metrics/simple"> Simple Metrics </a></li>\n                                    \n                                    <li><a href="/metrics?date=5&view=dashboard"> Metrics Dashboard </a></li>\n                                </ul>\n                                <!-- /.nav-second-level -->\n                            </li>\n                            \n                            \n                                                            \n                                <li id="menu_configuration">\n\t\t\t\t                    <a href="#" aria-expanded="false" aria-label="Configuration">\n                                        <i class="fa fa-cog fa-fw"></i>\n                                        <span>Configuration</span>\n                                    </a>\n                                    <ul class="nav nav-second-level">\n                                        \n                                        <li><a href="/notifications/personal">Notifications</a></li>\n                                    </ul>\n                        \n\n                        <li id="min-menu">\n                            <a href="#" id="minimize-menu" title="Expand/Collapse Menu" aria-label="Expand/Collapse Menu">\n                                <i id="nav-minimize-menu-li" class="fa fa-arrow-circle-right fa-fw"></i>\n                                <span>Collapse Menu</span>\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n                <!-- /.sidebar-collapse -->\n            </div>\n            <!-- /.navbar-static-side -->\n        </nav>\n    \n    <!-- Page Content -->\n    <div id="page-wrapper">\n        <div class="container-fluid">\n            <!-- start of tabs -->\n            \n            <div class="row hidden-xs">\n                <div class="col-lg-12">\n                    \n                        <ul class="breadcrumb main">\n                            \n                                <li class="">\n                                    <a class=""\n                                       href="/">Home</a>\n                                </li>\n                            \n                                <li class="active">\n                                    <a class="active"\n                                       href="/metrics">Product Type Metrics by Findings</a>\n                                </li>\n                            \n                        </ul>\n                    \n                </div>\n            </div>\n            \n            <!-- end of tabs -->\n            <div class="row">\n                <div class="col-lg-12">\n                    \n                </div>\n                <!-- /.col-lg-12 -->\n            </div>\n            <!-- /.row -->\n            <div class="row">\n                <div id="base-content" class="col-lg-12">\n                    \n\n                    \n\n                    \n\n                    \n\n                    \n\n                    \n    <div class="col-md-12">\n        <div class="panel panel-default">\n            <div class="panel-heading tight">\n                <div class="clearfix">\n                    <h3 class="has-filters" >\n                        Product Type Metrics by Findings\n                        \n                        \n                            <div class="dropdown pull-right">\n                                <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenu1"\n                                        data-toggle="dropdown" label="view_selector" aria-label="view_selector" aria-expanded="true">\n                                    <span class="fa fa-bars"></span>\n                                    <span class="caret"></span>\n                                </button>\n                                <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1">\n                                    <li role="presentation">\n                                        <a href="/metrics/product/type?type=Finding">\n                                            <i class="fa fa-file-text-o"></i> Measures Findings\n                                        </a>\n                                    </li>\n                                    <li role="presentation">\n                                        <a href="/metrics/product/type?type=Endpoint">\n                                            <i class="fa fa-file-text-o"></i> Measure Affected Endpoints\n                                        </a>\n                                    </li>\n                                </ul>\n                            </div>\n                        \n                    </h3>\n                    \n                </div>\n            </div>\n            <div id="the-filters" class="panel-body collapse">\n                \n\n\n    <link rel="stylesheet" href="/static/chosen-bootstrap/chosen.bootstrap.min.css">\n\n<div class="filter-set">\n    <form method="get"  class="metrics-filters form-inline dojo-filter-set">\n        \n            <div class="form-group">\n                \n                <label for="id_title">Title:</label> <input type="text" name="title" id="id_title">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_date">Date:</label> <select name="date" id="id_date">\n  <option value="" selected>---------</option>\n\n  <option value="">Past 30 days</option>\n\n  <option value="1">Past 7 days</option>\n\n  <option value="2">Past 90 days</option>\n\n  <option value="3">Current month</option>\n\n  <option value="4">Current year</option>\n\n  <option value="5">Past 6 Months</option>\n\n  <option value="6">Past year</option>\n\n  <option value="7">Any date</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_cwe">CWE:</label> <input type="number" name="cwe" step="any" id="id_cwe">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_cve">CVE:</label> <input type="text" name="cve" id="id_cve">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_cvssv3">CVSSv3:</label> <input type="text" name="cvssv3" id="id_cvssv3">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_severity">Severity:</label> <select name="severity" id="id_severity" multiple>\n  <option value="High">High</option>\n\n  <option value="Low">Low</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_impact">Impact:</label> <input type="text" name="impact" id="id_impact">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_steps_to_reproduce">Steps to Reproduce:</label> <input type="text" name="steps_to_reproduce" id="id_steps_to_reproduce">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_severity_justification">Severity Justification:</label> <input type="text" name="severity_justification" id="id_severity_justification">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_test">Test:</label> <select name="test" id="id_test">\n  <option value="" selected>---------</option>\n\n  <option value="3">ZAP Scan</option>\n\n  <option value="4">ZAP Scan</option>\n\n  <option value="13">ZAP Scan</option>\n\n  <option value="14">ZAP Scan</option>\n\n  <option value="33">Generic Findings Import</option>\n\n  <option value="55">Checkmarx Scan detailed</option>\n\n  <option value="66">Checkmarx Scan detailed</option>\n\n  <option value="77">Veracode Scan</option>\n\n  <option value="88">Veracode Scan</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_active">Active:</label> <select name="active" id="id_active">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_verified">Verified:</label> <select name="verified" id="id_verified">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_false_p">False Positive:</label> <select name="false_p" id="id_false_p">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_duplicate">Duplicate:</label> <select name="duplicate" id="id_duplicate">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_duplicate_finding">Duplicate Finding:</label> <select name="duplicate_finding" id="id_duplicate_finding">\n  <option value="" selected>---------</option>\n\n  <option value="2">High Impact Test Finding</option>\n\n  <option value="22">Low Impact Test Finding</option>\n\n  <option value="124">Low Impact Test Finding</option>\n\n  <option value="224">UID Impact Test Finding</option>\n\n  <option value="3">High Impact Test Finding</option>\n\n  <option value="4">High Impact Test Finding</option>\n\n  <option value="5">High Impact Test Finding</option>\n\n  <option value="6">High Impact Test Finding</option>\n\n  <option value="23">Low Impact Test Finding</option>\n\n  <option value="24">Low Impact Test Finding</option>\n\n  <option value="125">Low Impact Test Finding</option>\n\n  <option value="225">UID Impact Test Finding</option>\n\n  <option value="7">DUMMY FINDING</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_out_of_scope">Out Of Scope:</label> <select name="out_of_scope" id="id_out_of_scope">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_under_review">Under Review:</label> <select name="under_review" id="id_under_review">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_under_defect_review">Under Defect Review:</label> <select name="under_defect_review" id="id_under_defect_review">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_is_Mitigated">Is Mitigated:</label> <select name="is_Mitigated" id="id_is_Mitigated">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_mitigated">Mitigated:</label> <input type="text" name="mitigated" id="id_mitigated">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_mitigated_by">Mitigated By:</label> <select name="mitigated_by" id="id_mitigated_by">\n  <option value="" selected>---------</option>\n\n  <option value="1">admin</option>\n\n  <option value="2">user1</option>\n\n  <option value="3">user2</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_reporter">Reporter:</label> <select name="reporter" id="id_reporter">\n  <option value="" selected>---------</option>\n\n  <option value="1">admin</option>\n\n  <option value="2">user1</option>\n\n  <option value="3">user2</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_numerical_severity">Numerical Severity:</label> <input type="text" name="numerical_severity" id="id_numerical_severity">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_last_reviewed">Last Reviewed:</label> <input type="text" name="last_reviewed" id="id_last_reviewed">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_line_number">Line Number:</label> <input type="text" name="line_number" id="id_line_number">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sourcefilepath">Source File Path:</label> <input type="text" name="sourcefilepath" id="id_sourcefilepath">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sourcefile">Source File:</label> <input type="text" name="sourcefile" id="id_sourcefile">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_param">Parameter:</label> <input type="text" name="param" id="id_param">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_payload">Payload:</label> <input type="text" name="payload" id="id_payload">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_hash_code">Hash Code:</label> <input type="text" name="hash_code" id="id_hash_code">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_line">Line number:</label> <input type="number" name="line" step="any" id="id_line">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_file_path">File path:</label> <input type="text" name="file_path" id="id_file_path">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_component_name">Component name:</label> <input type="text" name="component_name" id="id_component_name">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_component_version">Component version:</label> <input type="text" name="component_version" id="id_component_version">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_found_by">Found by:</label> <select name="found_by" id="id_found_by" multiple>\n  <option value="2">BURP Scan</option>\n\n  <option value="999">Checkmarx Scan detailed</option>\n\n  <option value="120">Generic Findings Import</option>\n\n  <option value="3">NESSUS Scan</option>\n\n  <option value="555">Veracode Scan</option>\n\n  <option value="1">ZAP Scan</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_static_finding">Static finding (SAST):</label> <select name="static_finding" id="id_static_finding">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_dynamic_finding">Dynamic finding (DAST):</label> <select name="dynamic_finding" id="id_dynamic_finding">\n  <option value="unknown" selected>Unknown</option>\n\n  <option value="true">Yes</option>\n\n  <option value="false">No</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_created">Created:</label> <input type="text" name="created" id="id_created">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_scanner_confidence">Scanner confidence:</label> <input type="number" name="scanner_confidence" step="any" id="id_scanner_confidence">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sonarqube_issue">SonarQube issue:</label> <select name="sonarqube_issue" id="id_sonarqube_issue">\n  <option value="" selected>---------</option>\n\n  <option value="1">AREwS5n5TxsDNHm31CxP</option>\n\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_unique_id_from_tool">Unique ID from tool:</label> <input type="text" name="unique_id_from_tool" id="id_unique_id_from_tool">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_vuln_id_from_tool">Vulnerability ID from tool:</label> <input type="text" name="vuln_id_from_tool" id="id_vuln_id_from_tool">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sast_source_object">SAST Source Object:</label> <input type="text" name="sast_source_object" id="id_sast_source_object">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sast_sink_object">SAST Sink Object:</label> <input type="text" name="sast_sink_object" id="id_sast_sink_object">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sast_source_line">SAST Source Line number:</label> <input type="number" name="sast_source_line" step="any" id="id_sast_source_line">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_sast_source_file_path">SAST Source File Path:</label> <input type="text" name="sast_source_file_path" id="id_sast_source_file_path">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_nb_occurences">Number of occurences:</label> <input type="number" name="nb_occurences" step="any" id="id_nb_occurences">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_start_date">Start Date:</label> <input type="text" name="start_date" id="id_start_date">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_end_date">End Date:</label> <input type="text" name="end_date" id="id_end_date">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_test__engagement__product__prod_type">Product Type:</label> <select name="test__engagement__product__prod_type" id="id_test__engagement__product__prod_type" multiple>\n</select>\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_test__engagement__version">Engagement Version:</label> <input type="text" name="test__engagement__version" id="id_test__engagement__version">\n            </div>\n        \n            <div class="form-group">\n                \n                <label for="id_status">Status:</label> <select name="status" id="id_status">\n  <option value="" selected>---------</option>\n\n  <option value="">Any</option>\n\n  <option value="0">Open</option>\n\n  <option value="1">Closed</option>\n\n</select>\n            </div>\n        \n        \n            <div class="inline-block" style="vertical-align: text-top">\n                <button id="apply" class="btn btn-sm btn-primary">\n                    <i class="fa fa-filter"></i> Apply Filters\n                </button>\n                &nbsp;\n                \n                    <a href="/metrics/product/type" id="clear" class="clear centered"> [Clear Filters] </a>\n                \n            </div>\n        \n    </form>\n\n</div>\n\n\n\n            </div>\n        </div>\n    </div>\n\n    <div class="row metric-data">\n        <div class="col-md-12">\n            \n            <div class="row">\n                \n                    <div class="col-lg-6">\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                Open Bug Count by Month\n                            </div>\n                            <!-- /.panel-heading -->\n                            <div class="panel-body">\n                                <div id="chart_div"></div>\n                            </div>\n                            <!-- /.panel-body -->\n                        </div>\n                        <!-- /.panel -->\n                    </div>\n                \n                \n                    <div class="col-lg-6">\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                Active Bug Count by Month\n                            </div>\n                            <!-- /.panel-heading -->\n                            <div class="panel-body">\n                                <div id="chart_div5"></div>\n                            </div>\n                            <!-- /.panel-body -->\n                        </div>\n                        <!-- /.panel -->\n                    </div>\n                \n\n                \n                    <div class="col-lg-6">\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                Risk Accepted Bug Count by Month\n                            </div>\n                            <!-- /.panel-heading -->\n                            <div class="panel-body">\n                                <div id="chart_div2"></div>\n                            </div>\n                            <!-- /.panel-body -->\n                        </div>\n                        <!-- /.panel -->\n                    </div>\n                \n                \n                    <div class="col-lg-12">\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                Open Bug Count by Week\n                            </div>\n                            <!-- /.panel-heading -->\n                            <div class="panel-body">\n                                <div id="chart_div3"></div>\n                            </div>\n                            <!-- /.panel-body -->\n                        </div>\n                        <!-- /.panel -->\n                    </div>\n                    <div class="col-lg-12">\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                Risk Accepted Bug Count by Week\n                            </div>\n                            <!-- /.panel-heading -->\n                            <div class="panel-body">\n                                <div id="chart_div4"></div>\n                            </div>\n                            <!-- /.panel-body -->\n                        </div>\n                        <!-- /.panel -->\n                    </div>\n                    </div>\n                    </div>\n                    </div>\n                    <div class="row" id="metric_counts">\n                        <div class="col-md-12">\n                            <h3>Metric Counts</h3>\n                        </div>\n                        <div class="col-md-12">\n                            <div class="tabbable tabs-left">\n                                <ul class="nav nav-tabs">\n                                    \n                                        <li class="active"><a data-toggle="tab" href="#tabs-1">Top\n                                            10 Products <br/> by bug severity\n                                        </a></li> \n                                    <li><a data-toggle="tab" href="#tabs-2">Detail Breakdown</a></li>\n                                    <li><a data-toggle="tab" href="#tabs-3">Opened Findings</a></li>\n                                    <li><a data-toggle="tab" href="#tabs-4">Accepted Findings</a></li>\n                                    <li><a data-toggle="tab" href="#tabs-5">Closed Findings</a></li>\n                                    <li><a data-toggle="tab" href="#tabs-6">Trending Open <br/>\n                                        Bug Count\n                                    </a></li>\n                                    <li><a data-toggle="tab" href="#tabs-7">Trending Accepted <br/>\n                                        Bug Count\n                                    </a></li>\n                                    <li><a data-toggle="tab" href="#tabs-8">Age of Issues</a></li>\n                                </ul>\n                                <div class="tab-content">\n                                    \n                                        <div class="table-responsive tab-pane active" id="tabs-1">\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-400">\n                                                <tr>\n                                                    <th>Product</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Total</th>\n                                                </tr>\n                                                \n                                                    <tr>\n                                                        <td><a href="/product/2">Security How-to</a>\n                                                        </td>\n                                                        <td>0</td>\n                                                        <td>1</td>\n                                                        <td>0</td>\n                                                        <td>3</td>\n                                                        <td>4</td>\n                                                    </tr>\n                                                \n                                            </table>\n                                        </div>\n                                    \n                                    <div class="tab-pane table-responsive" id="tabs-2">\n                                        <table class="table table-bordered table-condensed table-striped table-600">\n                                            <tr>\n                                                <th class="nowrap">Team</th>\n                                                <th class="">Product</th>\n                                                <th>Severity</th>\n                                                <th>Description</th>\n                                                <th class="nowrap">Days<br/>Open</th>\n                                                <th class="nowrap">Status</th>\n                                                <th class="nowrap">Engineer</th>\n\n                                            </tr>\n                                            \n                                        </table>\n                                    </div>\n                                    <div class="tab-pane" id="tabs-3">\n                                        <div class="table-responsive">\n                                            <h4>Opened During Period</h4>\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-600">\n                                                <tr>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Info</th>\n                                                    <th>Total</th>\n                                                </tr>\n                                                <tr>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                </tr>\n                                            </table>\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-600">\n                                                <tr>\n                                                    <th>Product</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Info</th>\n                                                    <th>Total</th>\n\n                                                </tr>\n                                                \n                                            </table>\n                                        </div>\n                                    </div>\n                                    <div class="tab-pane" id="tabs-4">\n                                        <div class="table-responsive">\n                                            <h4>Accepted in Period</h4>\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-600">\n                                                <tr>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Info</th>\n                                                    <th>Total</th>\n                                                </tr>\n                                                <tr>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                </tr>\n                                            </table>\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-600">\n                                                <tr>\n                                                    <th>Product</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Info</th>\n                                                    <th>Total</th>\n\n                                                </tr>\n                                                \n                                            </table>\n                                        </div>\n\n\n                                    </div>\n                                    <div class="tab-pane" id="tabs-5">\n                                        <div class="table-responsive">\n                                            <h4>Closed in Period</h4>\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-600">\n                                                <tr>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Info</th>\n                                                    <th>Total</th>\n                                                </tr>\n                                                <tr>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                    <td>0</td>\n                                                </tr>\n                                            </table>\n                                            <table\n                                                    class="table table-bordered table-condensed table-striped table-600">\n                                                <tr>\n                                                    <th>Product</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Info</th>\n                                                    <th>Total</th>\n\n                                                </tr>\n                                                \n                                            </table>\n                                        </div>\n                                    </div>\n                                    <div class="tab-pane" id="tabs-6">\n                                        <div class="metric-half table-responsive">\n                                            <table class="table table-bordered table-condensed table-striped">\n                                                <tr>\n                                                    <th>Weekly</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Total</th>\n                                                    <th>Closed*</th>\n                                                </tr>\n                                                \n                                                    <tr>\n                                                        <td>12-28-2009</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                                    <tr>\n                                                        <td>01-04-2010</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                                    <tr>\n                                                        <td>01-11-2010</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                            </table>\n                                        </div>\n                                        <div class="metric-half table-responsive">\n                                            <table class="table table-bordered table-condensed table-striped">\n                                                <tr>\n                                                    <th>Monthly</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Total</th>\n                                                    <th>Closed*</th>\n                                                </tr>\n                                                \n                                                    <tr>\n                                                        <td>12-2009</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                                    <tr>\n                                                        <td>01-2010</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                            </table>\n                                            <p>*Closed findings may have been opened outside of requested period.</p>\n                                        </div>\n                                    </div>\n                                    <div class="tab-pane" id="tabs-7">\n                                        <div class="metric-half table-responsive">\n                                            <table class="table table-bordered table-condensed table-striped">\n                                                <tr>\n                                                    <th>By Week</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Total</th>\n                                                </tr>\n                                                \n                                                    <tr>\n                                                        <td>12-28-2009</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                                    <tr>\n                                                        <td>01-04-2010</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                                    <tr>\n                                                        <td>01-11-2010</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                            </table>\n                                        </div>\n                                        <div class="metric-half table-responsive">\n                                            <table class="table table-bordered table-condensed table-striped">\n                                                <tr>\n                                                    <th>By Month</th>\n                                                    <th>Critical</th>\n                                                    <th>High</th>\n                                                    <th>Medium</th>\n                                                    <th>Low</th>\n                                                    <th>Total</th>\n                                                </tr>\n                                                \n                                                    <tr>\n                                                        <td>12-2009</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                                    <tr>\n                                                        <td>01-2010</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                        <td>0</td>\n                                                    </tr>\n                                                \n                                            </table>\n                                        </div>\n                                    </div>\n                                    <div class="tab-pane table-responsive" id="tabs-8">\n                                        <table\n                                                class="table table-bordered table-condensed table-striped table-400">\n                                            <tr>\n                                                <th>Days</th>\n                                                <th>Bug Count</th>\n                                            </tr>\n                                            <tr>\n                                                <td>0 - 30 Days</td>\n                                                <td>0</td>\n                                            </tr>\n                                            <tr>\n                                                <td>31 - 60 Days</td>\n                                                <td>0</td>\n                                            </tr>\n                                            <tr>\n                                                <td>61 - 90 Days</td>\n                                                <td>0</td>\n                                            </tr>\n                                            <tr>\n                                                <td>91+ Days</td>\n                                                <td>0</td>\n                                            </tr>\n                                        </table>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                \n    <br/>\n    <br/>\n    <br/>\n\n                </div>\n                <!-- /.col-lg-12 -->\n            </div>\n        </div>\n        <!-- /.container-fluid -->\n    </div>\n    <!-- /#page-wrapper -->\n    <footer class="footer">\n        <div class="container">\n            <div class="row">\n                <div class="col-md-12 text-center text-">\n                    <p>\n                        <a href="/"><img class="logo" src="/static/dojo/img/chop.png"\n                                                        alt="DefectDojo Chop" height="45"/></a><br/>\n                        v. unit tests ( release mode )\n                    </p>\n                    <p>\n                        Detailed DefectDojo documentation can be found at  <a\n                            href="http://defectdojo.readthedocs.io/">Read The Docs</a>.\n                    </p>\n                    <p>\n                        DefectDojo is licensed under the <a\n                            href="https://github.com/DefectDojo/django-DefectDojo/blob/master/LICENSE.md">Simplified BSD\n                        license</a>.\n                    </p>\n                    <p>\n                        &copy; 2020 DefectDojo\n                    </p>\n                </div>\n            </div>\n        </div>\n        <p id="alert_refresh" class="hidden">True</p>\n        <p id="disable_count" class="hidden">False</p>\n    </footer>\n</div>\n\n<!-- /#wrapper -->\n\n<!-- our JS -->\n<script src="/static/dojo/js/index.js"></script>\n\n<!-- our CVSS stuff -->\n<script src="/static/dojo/js/cvsscalc30_helptext.js"></script>\n<script src="/static/dojo/js/cvsscalc30.js"></script>\n<script src="/static/dojo/js/cvss_calculator.js"></script>\n<script type="application/javascript">\n    $(document).ready(function() {\n        disable_count = document.getElementById(\'disable_count\').innerHTML\n        refresh = document.getElementById(\'alert_refresh\').innerHTML\n\n        $(\'.has-popover\').popover({\'trigger\':\'hover\'});\n        \n            $(\'.dropdown-toggle\').click(function() {\n                if (disable_count == "False" || refresh == \'True\') { \n                    get_alerts(); \n                }\n            });\n            \n            if (disable_count == "False") {\n                if(refresh == \'True\') {\n                    setInterval(function() {\n                        update_alertcount();\n                    }, 10000);\n                } else {\n                    update_alertcount();\n                }\n            }\n        \n\n        function update_alertcount() {\n            $.get("/alerts/count", function (data) {\n                if (data.count != $(\'#alert_count\').text()) {\n                    $(\'#alert_count\').text(data.count);\n                    $(\'#alert_count\').removeClass().addClass(\'badge badge-count badge-count\' + data.count);\n                }\n            });\n        }\n\n        function htmlEscape(str) {\n          return str\n            .replace(/\\n/g, " ")\n            .replace(/&/g, \'&amp;\')\n            .replace(/"/g, \'&quot;\')\n            .replace(/\'/g, \'&#39;\')\n            .replace(/</g, \'&lt;\')\n            .replace(/>/g, \'&gt;\');\n        }\n\n        function get_alerts() {\n            $(\'.dropdown-alerts\').html(\'<div class="text-center"><i class="fa fa-spin fa-spinner"></i></div>\');\n            $.get("/alerts/json?limit=12", function (data) {\n                $(\'.dropdown-alerts\').empty();\n                $.each(data, function(i, elem) {\n                  var titleField = elem.fields.title ? elem.fields.title : elem.fields.description;\n                  var display_title = titleField.length < 50 ? titleField : jQuery.trim(titleField).substring(0,50).trim(this) + \'...\';\n                  var description = elem.fields.description\n                  var display_description = description ? description.length < 100 ? description : jQuery.trim(description).substring(0,100).trim(this) + \'...\': \'\'\n                  var dropdown_alert = "alert-list" + i;\n                  $(\'.dropdown-alerts\').append(\'<li><div style="padding: 3px 20px;"><i class="fa fa-\' + htmlEscape(elem.fields.icon) +\n                                                \' fa-fw"></i><a href="\' + htmlEscape(elem.fields.url) + \'" id=\' + dropdown_alert + \n                                                \' title="\' + htmlEscape(display_description) + \'"></a><span class="pull-right text-muted small">\' +\n                                               htmlEscape(elem.fields.source) + \'</span></div></li><li class="divider"></li>\');\n                  $("#" + dropdown_alert).text(display_title);\n                });\n                $(\'.dropdown-alerts\').append(\'<li><a class="text-center" href="/alerts"><strong>See All Alerts </strong>\' +\n                                             \'<i class="fa fa-angle-right"></i></a></li>\');\n                $(\'.dropdown-alerts\').append(\'<li><a class="text-center" href="/delete_alerts"><strong>Clear All Alerts </strong>\' +\n                                           \'<i class="fa fa-angle-right"></i></a></li>\');\n            });\n        }\n\n        $("#id_jiraform-jira_issue").on(\'paste\', function(e) {\n            var clipboardData = e.clipboardData || e.originalEvent.clipboardData || window.clipboardData;\n            var pastedData = clipboardData.getData(\'text\');\n\n            $this = $(this)\n            // if someone entered/pasted a full URL, we strip evertyhing until last \'/\'\n            setTimeout(function (elem) {\n                $this.val($this.val().substring($this.val().lastIndexOf("/") + 1));\n            }, 100);\n        });\n\n    });\n</script>\n\n\n    <!-- Flot Charts JavaScript -->\n    <script src="/static/flot/excanvas.min.js"></script>\n    <script src="/static/flot/jquery.flot.js"></script>\n    <script src="/static/flot/jquery.flot.pie.js"></script>\n    <script src="/static/flot/jquery.flot.resize.js"></script>\n    <script src="/static/flot/jquery.flot.time.js"></script>\n    <script src="/static/jquery.flot.tooltip/js/jquery.flot.tooltip.min.js"></script>\n    <script src="/static/flot/jquery.flot.stack.js"></script>\n    \n<script type="application/javascript" src="/static/chosen-js/chosen.jquery.min.js"></script>\n<script type="application/javascript">\n    $(function () {\n        $(".metrics-filters :input").not("button").addClass("form-control input-sm");\n        $(".metrics-filters label").css("display", "block");\n\n        $(".metrics-filters input[type=text]").each(function () {\n            var id = this.id;\n            var label = $("label[for=" + id + "]");\n            $(this).attr("placeholder", label.html().replace(\':\', "..."));\n        });\n\n        var toggle = $(\' <button id="show-filters" data-toggle="collapse" data-target="#the-filters" class="btn btn-primary"> <i class="fa fa-filter"></i> <i class="caret"></i> </button>\')\n        $(".has-filters .dropdown.pull-right").first().prepend(toggle);\n        toggle.on(\'click\', function () {\n            $(this).toggleClass("dropup");\n        })\n\n        $(\'.metrics-filters select[multiple=multiple]\').each(function () {\n            var id = this.id\n            var label = $("label[for=" + id + "]");\n            $(this).chosen({\n                \'placeholder_text_multiple\': label.html().replace(\':\', "..."),\n                \'width\': \'200px !important\'\n            });\n        })\n\n        var title_words = [\n                \n            ];\n            \n            $("#id_title, #id_finding-title").autocomplete({\n                source: title_words\n            });\n\n            var component_words = [\n                \n            ];\n            \n            $("#id_component_name, #id_finding-component_name").autocomplete({\n                source: component_words \n            });\n\n    })\n</script>\n    <script src="/static/justgage/raphael.min.js"></script>\n    <script src="/static/justgage/justgage.js"></script>\n    \n    <script>\n        $(\'.gaugeloop\').each(function () {\n            j_obj = $(this);\n            var g_id = j_obj.attr(\'id\');\n            var g_title = j_obj.attr(\'name\');\n            var g_start = j_obj.attr(\'start\');\n            var g = new JustGage({\n                id: g_id,\n                value: g_start,\n                levelColors: ["#FF0000", "#F9C802", "#A9D70B"],\n                min: 0,\n                max: 100,\n            });\n        });\n        $(function () {\n            \n\n            \n                chart_div();\n            \n            \n                chart_div5();\n            \n            \n                chart_div2();\n            \n            \n                chart_div3();\n                chart_div4();\n            \n\n            \n                function chart_div() {\n                    var critical = [],\n                        high = [],\n                        medium = [],\n                        low = [];\n\n                    \n                        critical.push([1259625600000, 0]);\n                        high.push([1259625600000, 0]);\n                        medium.push([1259625600000, 0]);\n                        low.push([1259625600000, 0]);\n                    \n                        critical.push([1262304000000, 0]);\n                        high.push([1262304000000, 0]);\n                        medium.push([1262304000000, 0]);\n                        low.push([1262304000000, 0]);\n                    \n\n                    var tick_count = critical.length < 7 ? critical.length : 7;\n                    var options = {\n                        xaxis: {\n                            mode: "time",\n                            timeformat: "%m-%d-%Y",\n                            timezone: \'browser\'\n                        },\n                        xaxes: [{\n                            ticks: tick_count\n                        }],\n                        yaxes: [{\n                            min: 0\n                        }],\n                        series: {\n                            lines: {\n                                show: true\n                            },\n                            points: {\n                                show: true\n                            }\n                        },\n                        grid: {\n                            hoverable: true,\n                            borderWidth: 1,\n                            borderColor: \'#e7e7e7\'\n\n                        },\n                        tooltip: true\n                    };\n                    var plotObj = $.plot($("#chart_div"), [{\n                            data: critical,\n                            label: " Critical",\n                            color: "#d9534f",\n\n                        }, {\n                            data: high,\n                            label: " High",\n                            color: \'#f0ad4e\',\n\n                        }, {\n                            data: medium,\n                            label: " Medium",\n                            color: \'#f0de28\',\n\n                        }, {\n                            data: low,\n                            label: " Low",\n                            color: \'#337ab7\',\n\n                        }],\n                        options);\n                }\n            \n            \n                function chart_div5() {\n                    var critical = [],\n                        high = [],\n                        medium = [],\n                        low = [];\n\n                    \n                        critical.push([1259625600000, 0]);\n                        high.push([1259625600000, 0]);\n                        medium.push([1259625600000, 0]);\n                        low.push([1259625600000, 0]);\n                    \n                        critical.push([1262304000000, 0]);\n                        high.push([1262304000000, 0]);\n                        medium.push([1262304000000, 0]);\n                        low.push([1262304000000, 0]);\n                    \n\n                    var tick_count = critical.length < 7 ? critical.length : 7;\n                    var options = {\n                        xaxis: {\n                            mode: "time",\n                            timeformat: "%m-%d-%Y",\n                            timezone: \'browser\'\n                        },\n                        xaxes: [{\n                            ticks: tick_count\n                        }],\n                        yaxes: [{\n                            min: 0\n                        }],\n                        series: {\n                            lines: {\n                                show: true\n                            },\n                            points: {\n                                show: true\n                            }\n                        },\n                        grid: {\n                            hoverable: true,\n                            borderWidth: 1,\n                            borderColor: \'#e7e7e7\'\n\n                        },\n                        tooltip: true\n                    };\n                    var plotObj = $.plot($("#chart_div5"), [{\n                            data: critical,\n                            label: " Critical",\n                            color: "#d9534f",\n\n                        }, {\n                            data: high,\n                            label: " High",\n                            color: \'#f0ad4e\',\n\n                        }, {\n                            data: medium,\n                            label: " Medium",\n                            color: \'#f0de28\',\n\n                        }, {\n                            data: low,\n                            label: " Low",\n                            color: \'#337ab7\',\n\n                        }],\n                        options);\n                }\n            \n\n            \n                function chart_div2() {\n                    var critical = [],\n                        high = [],\n                        medium = [],\n                        low = [];\n\n                    \n                        critical.push([1259625600000, 0]);\n                        high.push([1259625600000, 0]);\n                        medium.push([1259625600000, 0]);\n                        low.push([1259625600000, 0]);\n                    \n                        critical.push([1262304000000, 0]);\n                        high.push([1262304000000, 0]);\n                        medium.push([1262304000000, 0]);\n                        low.push([1262304000000, 0]);\n                    \n\n\n                    var tick_count = critical.length < 7 ? critical.length : 7;\n                    var options = {\n                        xaxis: {\n                            mode: "time",\n                            timeformat: "%m-%d-%Y",\n                            timezone: \'browser\'\n                        },\n                        xaxes: [{\n                            ticks: tick_count\n                        }],\n                        yaxes: [{\n                            min: 0\n                        }],\n                        series: {\n                            lines: {\n                                show: true\n                            },\n                            points: {\n                                show: true\n                            }\n                        },\n                        grid: {\n                            hoverable: true,\n                            borderWidth: 1,\n                            borderColor: \'#e7e7e7\'\n\n                        },\n                        tooltip: true\n                    };\n                    var plotObj = $.plot($("#chart_div2"), [{\n                            data: critical,\n                            label: " Critical",\n                            color: "#d9534f"\n                        }, {\n                            data: high,\n                            label: " High",\n                            color: \'#f0ad4e\'\n                        }, {\n                            data: medium,\n                            label: " Medium",\n                            color: \'#f0de28\'\n                        }, {\n                            data: low,\n                            label: " Low",\n                            color: \'#337ab7\'\n                        }],\n                        options);\n                }\n            \n\n            function chart_div3() {\n                var critical = [],\n                    high = [],\n                    medium = [],\n                    low = [];\n\n                \n                    critical.push([1261958400000, 0]);\n                    high.push([1261958400000, 0]);\n                    medium.push([1261958400000, 0]);\n                    low.push([1261958400000, 0]);\n                \n                    critical.push([1262563200000, 0]);\n                    high.push([1262563200000, 0]);\n                    medium.push([1262563200000, 0]);\n                    low.push([1262563200000, 0]);\n                \n                    critical.push([1263168000000, 0]);\n                    high.push([1263168000000, 0]);\n                    medium.push([1263168000000, 0]);\n                    low.push([1263168000000, 0]);\n                \n                var options = {\n                    xaxis: {\n                        mode: "time",\n                        timeformat: "%m-%d-%Y",\n                        timezone: \'browser\'\n                    },\n                    xaxes: [{\n                        ticks: 7\n                    }],\n                    yaxes: [{\n                        min: 0\n                    }],\n                    series: {\n                        lines: {\n                            show: true\n                        },\n                        points: {\n                            show: true\n                        }\n                    },\n                    grid: {\n                        hoverable: true,\n                        borderWidth: 1,\n                        borderColor: \'#e7e7e7\'\n\n                    },\n                    tooltip: true\n                };\n\n\n                var plotObj = $.plot($("#chart_div3"), [{\n                        data: critical,\n                        label: " Critical",\n                        color: "#d9534f"\n                    }, {\n                        data: high,\n                        label: " High",\n                        color: \'#f0ad4e\'\n                    }, {\n                        data: medium,\n                        label: " Medium",\n                        color: \'#f0de28\'\n                    }, {\n                        data: low,\n                        label: " Low",\n                        color: \'#337ab7\'\n                    }],\n                    options);\n            }\n\n            function chart_div4() {\n                var critical = [],\n                    high = [],\n                    medium = [],\n                    low = [];\n\n                \n                    critical.push([1261958400000, 0]);\n                    high.push([1261958400000, 0]);\n                    medium.push([1261958400000, 0]);\n                    low.push([1261958400000, 0]);\n                \n                    critical.push([1262563200000, 0]);\n                    high.push([1262563200000, 0]);\n                    medium.push([1262563200000, 0]);\n                    low.push([1262563200000, 0]);\n                \n                    critical.push([1263168000000, 0]);\n                    high.push([1263168000000, 0]);\n                    medium.push([1263168000000, 0]);\n                    low.push([1263168000000, 0]);\n                \n                var options = {\n                    xaxis: {\n                        mode: "time",\n                        timeformat: "%m-%d-%Y",\n                        timezone: \'browser\'\n                    },\n                    xaxes: [{\n                        ticks: 7\n                    }],\n                    yaxes: [{\n                        min: 0\n                    }],\n                    series: {\n                        lines: {\n                            show: true\n                        },\n                        points: {\n                            show: true\n                        }\n                    },\n                    grid: {\n                        hoverable: true,\n                        borderWidth: 1,\n                        borderColor: \'#e7e7e7\'\n\n                    },\n                    tooltip: true\n                };\n\n\n                var plotObj = $.plot($("#chart_div4"), [{\n                        data: critical,\n                        label: " Critical",\n                        color: "#d9534f"\n                    }, {\n                        data: high,\n                        label: " High",\n                        color: \'#f0ad4e\'\n                    }, {\n                        data: medium,\n                        label: " Medium",\n                        color: \'#f0de28\'\n                    }, {\n                        data: low,\n                        label: " Low",\n                        color: \'#337ab7\'\n                    }],\n                    options);\n            }\n        });\n    </script>\n\n</body>\n\n</html>\n'
            self.assertEqual(response.content.split(b'\n'), expected_content.split(b'\n'))


"""
class MetricsViewTest2(TestCase):
    fixtures = ['dojo_testdata.json']

    def setUp(self):
        self.client = Client()
        user = models.User.objects.get(username='user1')
        self.client.force_login(user)

        test = models.Test.objects.all().first()
        models.Finding.objects.bulk_create((
            models.Finding(
                title=f'finding {index}',
                severity=random.choice(('Critical', 'High', 'Medium', 'Low', 'Info')),
                test=test
            )
            for index in range(1000)
        ))

    @override_settings(FOOTER_VERSION='unit tests')
    @patch('git.Repo')
    @patch('django.utils.timezone.now')
    def test_query_count(self, mock_timezone, git_repo):
        # Mock the return value for `django.utils.timezone.now`
        mock_datetime = datetime(2010, 1, 1, tzinfo=timezone.utc)
        mock_timezone.return_value = mock_datetime

        # Mock the git repo to something that will throw an exception,
        # triggering release mode.
        git_repo.return_value = None

        # With the test data, assert on expected query count.
        with self.assertNumQueries(56):
            response = self.client.get(reverse('metrics'))
            self.assertEqual(response.status_code, 200)
"""
