<!-- we might not need this override, but maybe we will -->

{{- /* Get parameters */ -}}
{{- $currentPage := .currentPage -}}
{{- $nodes := .nodes -}}
{{- $version := .version | default "opensource" -}}

<nav class="section-nav docs-links">
  <ul class="list-unstyled">
    {{- range $nodes }}
      {{- $audience := .Page.Params.audience -}}
      {{- /* Skip pages that don't match the current version, unless audience is empty */ -}}
      {{- if and $audience (ne $audience $version) }}
        {{- continue }}
      {{- end }}
      {{- template "walk" (dict "node" . "currentPage" $currentPage) }}
    {{- end }}
  </ul>
</nav>

{{- define "walk" }}
  {{- $currentPage := .currentPage -}}
  {{- $node := .node -}}
  
  {{- $linkContent := $node.Page.LinkTitle -}}
  {{- with $node.Name }}
    {{- $linkContent = . }}
  {{- end }}

  {{- $ariaCurrent := "" -}}
  {{- $liClass := "" -}}

  {{- if in $currentPage.Ancestors $node.Page }}
    {{- $ariaCurrent = "true" }}
  {{- end }}

  {{- if $currentPage.Eq $node.Page }}
    {{- $ariaCurrent = "page" }}
    {{- $liClass = "active" }}
  {{- end }}

  <li {{- with $liClass }} class="{{ . }}" {{ end -}}>
    {{- with $node.Page.Pages }}
      <details{{- with $ariaCurrent }} open{{- end }}{{- if ne $node.Page.Params.sidebar.collapsed true }} open{{- end }}>
        <summary>{{ $linkContent }}</summary>
        <ul class="list-unstyled list-nested">
          {{- range . }}
            {{- template "walk" (dict "node" . "currentPage" $currentPage) }}
          {{- end }}
        </ul>
      </details>
    {{- else }}
      <a {{- with $ariaCurrent }} aria-current="{{ . }}" {{- end }} href="{{- $node.Page.RelPermalink }}">{{ $linkContent }}</a>
    {{- end }}
  </li>
{{- end }}
