---
title: "Github Vulnerability"
toc_hide: true
---
Import findings from Github vulnerability scan (GraphQL Query):
<https://help.github.com/en/github/managing-security-vulnerabilities>

Currently the parser is able to manage only `RepositoryVulnerabilityAlert` object.
The parser has some kind of search feature which detect the data in the report.

Here is the mandatory objects and attributes:
```
vulnerabilityAlerts (RepositoryVulnerabilityAlert object)
    + id
    + createdAt (optional)
    + vulnerableManifestPath (optional)
    + state (optional)
    + securityVulnerability (SecurityVulnerability object)
        + severity (CRITICAL/HIGH/LOW/MODERATE)
        + package (optional)
            + name (optional)
        + advisory (SecurityAdvisory object)
            + description
                + summary
                + description
                + identifiers
                    + value
                + references (optional)
                    + url (optional)
                + cvss (optional)
                    + score (optional)
                    + vectorString (optional)
                + cwes (optional)
```

References:
 - https://docs.github.com/en/graphql/reference/objects#repositoryvulnerabilityalert
 - https://docs.github.com/en/graphql/reference/objects#securityvulnerability

Github v4 graphql query to fetch data:

{{< highlight graphql >}}
    query getVulnerabilitiesByOwner($owner: String!) {
    search(query: $owner, type: REPOSITORY, first: 100) {
      nodes {
        ... on Repository {
          name
          vulnerabilityAlerts(last: 100) {
            nodes {
              id
              securityVulnerability {
                severity
                package {
                  name
                }
                advisory {
                  description
                  summary
                  identifiers {
                    type
                    value
                  }
                  references {
                    url
                  }
                }
              }
            }
          }
        }
      }
    }
  }
{{< /highlight >}}

Another example of Python script that query one repository:

```python

import json
import requests


query = """
query getVulnerabilitiesByRepoAndOwner($name: String!, $owner: String!) {
  repository(name: $name, owner: $owner) {
    vulnerabilityAlerts(first: 100) {
      nodes {
        id
        createdAt
        securityVulnerability {
          severity
          package {
            name
            ecosystem
          }
          advisory {
            description
            summary
            identifiers {
              value
              type
            }
            references {
              url
            }
            cvss {
              vectorString
            }
          }
        }
        vulnerableManifestPath
      }
    }
  }
}
"""

token = '...' # generated from GitHub settings
headers = {"Authorization": "Bearer " + token}


request = requests.post(url='https://api.github.com/graphql',
                        json={
                          "operationName": "getVulnerabilitiesByRepoAndOwner",
                          'query': query,
                          'variables': {
                            'name': 'gogoph',
                            'owner': 'damiencarol'
                          }
                        },
                        headers=headers)

result = request.json()
print(json.dumps(result, indent=2))
```
