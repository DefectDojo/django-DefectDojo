---
title: 'Upgrading to DefectDojo Version 2.54.x'
toc_hide: true
weight: -20251201
description: "Removal of django-auditlog & Helm chart: Postgresql from Bitnami was replaces with CloudPirates & Dropped support for DD_PARSER_EXCLUDE & Reimport performance improvements"
---

## Breaking Change: Removal of django-auditlog

Starting with DefectDojo 2.53, `django-auditlog` support has been removed in favour of `django-pghistory`.
This is designed to be a backwards compatible change, unless:
- You're querying the database directly for auditlog events, or,
- You've set the `DD_AUDITLOG_TYPE` environment variable (or `AUDITLOG_TYPE` settings field)

### Required Actions

If you're using `DD_AUDITLOG_TYPE`, remove it from your configuration/environment.

### Existing Records Preserved

Historical audit log entries stored in the `auditlog_logentry` table will continue to be displayed in the action history view for backward compatibility. No data migration is required.

### Benefits of django-pghistory

The switch to `django-pghistory` provides several advantages:

- **Better performance**: Database-level triggers reduce overhead compared to Django signal-based auditing
- **More features**: Enhanced context tracking and better support for complex queries
- **Better data integrity**: PostgreSQL-native implementation ensures consistency

### Migration Notes

- A one-time data migration will take place to populate the `django-pghistory` tables with the initial snapshot of the tracked models.
- The migration is designed to be fail-safe: if it fails for some reason, it will continue where it left off.
- The migration can also be performed up front via
  - `docker compose exec uwsgi bash -c "python manage.py pghistory_backfill_fast"`, or
  - `docker compose exec uwsgi bash -c "python manage.py pghistory_backfill_simple"`, or
  - `docker compose exec uwsgi bash -c "python manage.py pghistory_backfill"`

The backfill migration is not mandatory to succeed. If it fails for some reason, the only side effect will be that the first auditlog diff will contain all fields of an object instead just the changed fields.

## Breaking Change: Helm chart - Postgresql from Bitnami was replaces with CloudPirates

##### Renamed + removed values

HELM values had been changed to the following:
- `createPostgresqlSecret` → `createPostgresSecret`
- `postgresql.enabled` → `postgres.enabled`
- `postgresql.auth.username` → `postgres.auth.username`
- `postgresql.auth.password` → `postgres.auth.password`
- `postgresql.auth.database` → `postgres.auth.database`
- `postgresql.auth.existingSecret` → `postgres.auth.existingSecret`, plus value is pointing to secret `defectdojo-postgres-specific` now
- `postgresql.auth.secretKeys.adminPasswordKey` → `postgres.auth.secretKeys.adminPasswordKey`, plus value is pointing to secret `postgres-password` now
- `postgresql.auth.secretKeys.userPasswordKey` - is not used anymore
- `postgresql.auth.secretKeys.replicationPasswordKey` - is not used anymore
- `postgresql.architecture` - is not used anymore
- `postgresql.primary.service.ports.postgresql` → `postgres.service.port`
- rest of `postgresql.primary...` is not used anymore

TODO - finish this

The whole subchart is based on [`cloudpirates-postgres`](https://artifacthub.io/packages/helm/cloudpirates-postgres/postgres), so all additional values can be found there.

If an external Postgres instance is being used, set the parameter `postgres.enabled` to `False`. The parameter `postgresServer` remains available and function as before.

##### How to migrate to Valkey

0. As always, perform a backup of your instance
1. If you would like to be 100% sure that you do not miss any async event (triggered deduplication, email notification, ...) it is recommended to perform the following substeps (if your system is not in production and/or you are willing to miss some notifications or postpone deduplication to a later time, feel free to skip these substeps)
   0. Perform the following steps with your previous version of HELM chart (not with the upgraded one - you might lose your data)
   1. Downscale all producers of async tasks:
      - Set `django.replicas` to 0 (if you used HPA, adjust it based on your needs)
      - Set `celery.beat.replicas` to 0 (if you used HPA, adjust it based on your needs)
      - Do not change `celery.worker.replicas` (they are responsible for processing your async tasks)
   2. Wait until the processing queue is empty (choose one of the following methods):
      - ``kubectl exec statefulset/defectdojo-redis-master -c redis -- redis-cli -a `kubectl get secret defectdojo-redis-specific -o go-template='{{index .data "redis-password" | base64decode}}'` llen celery`` -- should output 0 (if your HELM chart used a different name, adjust the command based on your environment)
      - `kubectl logs deployment/defectdojo-celery-worker -c celery --all-pods=true --follow` -- should stop outputting new task logs
2. Replace values based on the _Renamed values_ part, update the chart version, and set the number of replicas back. Be aware that Valkey is using a password from the new location, and if you use `createRedisSecret`/`createValkeySecret` password will be regenerated. If you stored this password somewhere else, it will not be valid anymore.
3. Enjoy DefectDojo


## Dropped support for DD_PARSER_EXCLUDE

To simplify the management of the DefectDojo application, parser exclusions are no longer controlled via the environment variable DD_PARSER_EXCLUDE or application settings. This variable is now unsupported.
From now on, you should use the active flag in the Test_Type model to enable or disable parsers. Only parsers associated with active Test_Type entries will be available for use.

## Import/reimport performance improvements

DefectDojo 2.54.x includes performance improvements for reimporting scan results, especially for large scans:

- **Faster reimports** due to fewer database queries and more bulk operations.
- **Reduced database load** during reimport matching and post-processing (helps avoid slowdowns/timeouts under heavy scan volume).
- **More efficient endpoint status updates** during reimport of dynamic findings.
- **Less churn when updating vulnerability IDs**, avoiding unnecessary deletes/writes when nothing changed.

No action is required after upgrading. (Optional tuning knobs exist via `DD_IMPORT_REIMPORT_MATCH_BATCH_SIZE` and `DD_IMPORT_REIMPORT_DEDUPE_BATCH_SIZE`.)

There are other instructions for upgrading to 2.54.x. Check the Release Notes for the contents of the release: `https://github.com/DefectDojo/django-DefectDojo/releases/tag/2.54.0`
Check the [Release Notes](https://github.com/DefectDojo/django-DefectDojo/releases/tag/2.54.0) for the contents of the release.
