---
title: 'Upgrading to DefectDojo Version 2.52.x'
toc_hide: true
weight: -20251006
description: Replaced Redis with Valkey & Helm chart changes.
---

## Valkey

Since the license change at Redis the fork ValKey has become widely popular and is backed by industry giants such as AWS. AWS is advising to use ValKey over Redis and is using lower prices for ValKey compared to Redis.

Defect Dojo 2.52 now uses ValKey as a message broker. Teh existing redit volume can be used by Valkey, so this is just a drop in replacement.

If you want to know more or have a setup where you cannot just re-use the existing volume, please visit https://valkey.io/topics/migration/.

When you shutdown Defect Dojo to perform the upgrade, the celery tasks that are in the queue are storede to disk. After the upgrade, the celery workers will process these tasks as normal.

If you want to be 110% sure no tasks will be lost you could perform the upgrade in two steps:

1) Stop nginx, uwsgi, celerybeat to prevent new tasks from being created:

`docker compose down nginx, uwsgi, celerybeat`

2) Observe the Redis queue and/or the logs of the celeryworker(s) and wait until all tasks are finished:

`docker compose exec redis redis-cli llen celery` -- should output 0
`docker compose logs celeryworker` -- should stop outputting new task logs

3) Stop the remaining services:

`docker compose down`

4) Continue the upgrade as normal per the [upgrade guide](upgrading_guide)
`docker compose pull`
`docker compose up -d`

## Helm Chart Changes

This release introduces more important changes to the Helm chart configuration:

### Breaking changes

#### Security context

This Helm chart extends security context capabilities to all deployed pods and containers.
You can define a default pod and container security context globally using `securityContext.podSecurityContext` and `securityContext.containerSecurityContext` keys.
Additionally, each deployment can specify its own pod and container security contexts, which will override or merge with the global ones. 

#### Fine-grained resources

Now each container can specify the resource requests and limits.

#### Moved values

The following Helm chart values have been modified in this release:

- `securityContext.djangoSecurityContext` → deprecated in favor of container-specific security contexts (`celery.beat.containerSecurityContext`, `celery.worker.containerSecurityContext`, `django.uwsgi.containerSecurityContext` and `dbMigrationChecker.containerSecurityContext`)
- `securityContext.nginxSecurityContext` → deprecated in favor of container-specific security contexts (`django.nginx.containerSecurityContext`)

### Other changes

- **Extra annotations**: Now we can add common annotations to all resources.

There are other instructions for upgrading to 2.52.x. Check the [Release Notes](https://github.com/DefectDojo/django-DefectDojo/releases/tag/2.52.0) for the contents of the release.

## Release notes
Check the [Release Notes](https://github.com/DefectDojo/django-DefectDojo/releases/tag/2.52.0) for the contents of the release.
