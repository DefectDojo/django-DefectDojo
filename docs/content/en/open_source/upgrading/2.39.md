---
title: 'Upgrading to DefectDojo Version 2.39.x'
toc_hide: true
weight: -20240903
description: Major upgrade of Postgres 16 to 17
exclude_search: true
---

# PostgreSQL Major Version Upgrade in Docker Compose

This release incorporates a major upgrade of Postgres. When using the default docker compose setup you'll need to upgrade the Postgres data folder before you can use Defect Dojo 2.39.0.

There are lots of online guides to be found such as https://hub.docker.com/r/tianon/postgres-upgrade or https://github.com/pgautoupgrade/docker-pgautoupgrade.

There's also the [official documentation on `pg_upgrade`](https://github.com/pgautoupgrade/docker-pgautoupgrade), but this doesn't work out of the box when using Docker containers.

Sometimes it's easier to just perform the upgrade manually, which would look something like the steps below.
It may need some tuning to your specific needs and docker compose setup.

---

## 1. Start the Old Postgres Container

Edit your `docker-compose.yml` to use the old Postgres version (e.g., `postgres:16-alpine`):

```yaml
postgres:
  image: postgres:16-alpine
  ...
```

Start only the Postgres container:

```bash
docker-compose up -d postgres
```

---

## 2. Dump Your Database

**Option A: From your host (recommended if you have `pg_dump`):**

```bash
docker exec -t <postgres_container_name> pg_dump -U defectdojo -Fc defectdojo > defectdojo.dump
```

**Option B: From inside the container:**

```bash
docker exec -it <postgres_container_name> bash
pg_dump -U defectdojo -Fc defectdojo > /var/lib/postgresql/data/defectdojo.dump
```

---

## 3. Stop Containers and Remove the Old Volume

```bash
docker-compose down
docker volume rm defectdojo_postgres
```

---

## 4. Switch to the New Postgres Version

Edit your `docker-compose.yml` to use the new version (e.g., `postgres:17.5-alpine`):

```yaml
postgres:
  image: postgres:17.5-alpine
  ...
```

---

## 5. Start the New Postgres Container

```bash
docker-compose up -d postgres
```

---

## 6. Restore Your Database

**Copy the dump file into the new container:**

```bash
docker cp defectdojo.dump <postgres_container_name>:/defectdojo.dump
```

**Restore inside the container:**

```bash
docker exec -it <postgres_container_name> bash
pg_restore -U defectdojo -d defectdojo /defectdojo.dump
```

---

## 7. Start the Rest of Your Services

```bash
docker-compose up -d
```

---

## Notes

- Replace `<postgres_container_name>` with the actual name (use `docker ps` to find it).
- Always back up your data before starting.

---


Check the [Release Notes](https://github.com/DefectDojo/django-DefectDojo/releases/tag/2.39.0) for the contents of the release.
