---
version: '3.7'
services:
  uwsgi:
    entrypoint: ['/wait-for-it.sh', 'database:${DD_DATABASE_PORT}', '-t', '30', '--', '/entrypoint-uwsgi-dev.sh']
    volumes:
      - '.:/app:z'
    environment:
      DD_ADMIN_USER: "${DD_ADMIN_USER:-admin}"
      DD_ADMIN_PASSWORD: "${DD_ADMIN_PASSWORD:-admin}"
      DD_EMAIL_URL: "smtp://mailhog:1025"
  celeryworker:
    volumes:
      - '.:/app:z'
    environment:
      DD_EMAIL_URL: "smtp://mailhog:1025"
  celerybeat:
    volumes:
      - '.:/app:z'
  initializer:
    volumes:
      - '.:/app:z'
    environment:
      DD_ADMIN_USER: "${DD_ADMIN_USER:-admin}"
      DD_ADMIN_PASSWORD: "${DD_ADMIN_PASSWORD:-admin}"
  nginx:
    volumes:
      - './dojo/static/dojo:/usr/share/nginx/html/static/dojo'
  database:
    ports:
      - target: ${DD_DATABASE_PORT}
        published: ${DD_DATABASE_PORT}
        protocol: tcp
        mode: host
  mailhog:
    image: mailhog/mailhog:v1.0.1@sha256:8d76a3d4ffa32a3661311944007a415332c4bb855657f4f6c57996405c009bea
    ports:
      - target: 1025
        published: 1025
        protocol: tcp
        mode: host
      - target: 8025
        published: 8025
        protocol: tcp
        mode: host
# >>>>> PostgreSQL admin UI, only useful when using PostgreSQL >>>>>
#   pgadmin:
#     image: dpage/pgadmin4:6.4@sha256:e379d900081261dce78482e9a66bdc6f4c0dbe5924133cf7a3cd0c424ae6014f
#     environment:
#       PGADMIN_DEFAULT_EMAIL: pgadmin@defectdojo.org
#       PGADMIN_DEFAULT_PASSWORD: defectdojo
#     ports:
#       - target: 80
#         published: 8081
#         protocol: tcp
#         mode: host
#     volumes:
#       - defectdojo_pgadmin:/var/lib/pgadmin  
# volumes:
#   defectdojo_pgadmin: {}
# <<<<< PostgreSQL admin UI, only useful when using PostgreSQL <<<<<
