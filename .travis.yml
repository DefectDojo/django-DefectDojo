dist: xenial
language: minimal
services:
  - docker
env:
  global:
    - K8S_VERSION=v1.18.0
    - MINIKUBE_VERSION=v1.11.0
    - HELM_VERSION=v2.16.8
    - CHANGE_MINIKUBE_NONE_USER=true
  matrix:
    - TEST=flake8
    - TEST=integration_tests
    - TEST=docker
    - BROKER=rabbitmq DATABASE=mysql
    - BROKER=rabbitmq DATABASE=postgresql
    - BROKER=redis DATABASE=mysql
    - BROKER=redis DATABASE=postgresql
    - TEST=snyk
matrix: 
  allow_failures:
    - env: TEST=snyk
jobs:
  include:  
    - stage: deploy
      env: TEST=deploy
before_install: ['./travis/before-install.sh']
before_script: ['./travis/before-script.sh']
script: ['./travis/script.sh']
