<!doctype html><html lang=en-US data-bs-theme=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preload href=https://docs.defectdojo.com/fonts/vendor/jost/jost-v4-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://docs.defectdojo.com/fonts/vendor/jost/jost-v4-latin-500.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://docs.defectdojo.com/fonts/vendor/jost/jost-v4-latin-700.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://docs.defectdojo.com/fonts/worksans/work-sans-v19-latin-regular.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://docs.defectdojo.com/fonts/worksans/work-sans-v19-latin-500.woff2 as=font type=font/woff2 crossorigin><script src=/js/color-mode.86a91f050a481d0a3f0c72ac26543cb6228c770875981c58dcbc008fd3f875c8.js integrity="sha256-hqkfBQpIHQo/DHKsJlQ8tiKMdwh1mBxY3LwAj9P4dcg="></script><link rel=stylesheet href="/main.e8f6e43e386f97bc724796ae333da6be59b457908d66156db284ca6c0c16697f70a464f2f9f55131617a86ccfde28e9c452031a009c9df7edda12514b559b605.css" integrity="sha512-6PbkPjhvl7xyR5auMz2mvlm0V5CNZhVtsoTKbAwWaX9wpGTy+fVRMWF6hsz94o6cRSAxoAnJ337doSUUtVm2BQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><base href=https://docs.defectdojo.com/open_source/contributing/how-to-write-a-parser/><link rel=canonical href=https://docs.defectdojo.com/open_source/contributing/how-to-write-a-parser/><title>Contribute to Parsers | DefectDojo Documentation</title><meta name=description content="How to contribute to parsers"><link rel=icon href=/favicon.ico sizes=32x32><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png sizes=180x180 type=image/png><link rel=icon href=/favicon-192x192.png sizes=192x192 type=image/png><link rel=icon href=/favicon-512x512.png sizes=512x512 type=image/png><link rel=manifest href=/manifest.webmanifest><meta property="og:url" content="https://docs.defectdojo.com/open_source/contributing/how-to-write-a-parser/"><meta property="og:site_name" content="DefectDojo Documentation"><meta property="og:title" content="Contribute to Parsers"><meta property="og:description" content="How to contribute to parsers"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="open_source"><meta property="og:image" content="https://docs.defectdojo.com/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://docs.defectdojo.com/cover.png"><meta name=twitter:title content="Contribute to Parsers"><meta name=twitter:description content="How to contribute to parsers"><meta name=twitter:site content="@getdoks"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://docs.defectdojo.com/","name":"Defect Dojo Documentation","position":1},{"@type":"ListItem","item":"https://docs.defectdojo.com/open_source/","name":"Open Source Defect Dojo","position":2},{"@type":"ListItem","item":"https://docs.defectdojo.com/open_source/contributing/","name":"Contributing","position":3},{"@type":"ListItem","name":"Contribute to Parsers","position":4}]}</script><script type=text/javascript>!function(){var e,t="a92cfcfa51eca96",n=function(){Reo.init({clientID:"a92cfcfa51eca96"})};(e=document.createElement("script")).src="https://static.reo.dev/"+t+"/reo.js",e.async=!0,e.onload=n,document.head.appendChild(e)}()</script><script>function initApollo(){var t=Math.random().toString(36).substring(7),e=document.createElement("script");e.src="https://assets.apollo.io/micro/website-tracker/tracker.iife.js?nocache="+t,e.async=!0,e.defer=!0,e.onload=function(){window.trackingFunctions.onLoad({appId:"68ffca00b8c4dc001de5fec3"})},document.head.appendChild(e)}initApollo()</script><link rel=stylesheet href=https://docs.defectdojo.com/css/main.min.css></head><body class="single section open_source" data-bs-spy=scroll data-bs-target=#toc data-bs-root-margin="0px 0px -60%" data-bs-smooth-scroll=true tabindex=0><div class=sticky-top><header class="navbar navbar-expand-lg"><div class=container-lg><div id=docsearch class=d-none tabindex=-1 aria-disabled=true></div><button type=button id=searchToggleMobile class="btn btn-link nav-link mx-2 d-lg-none" aria-label="Search website">
<svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
<button class="btn btn-link nav-link mx-2 order-3 d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasNavMain aria-controls=offcanvasNavMain aria-label="Open main navigation menu">
<svg class="icon icon-tabler icon-tabler-menu" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="8" x2="20" y2="8"/><line x1="4" y1="16" x2="20" y2="16"/></svg></button><div class="offcanvas offcanvas-end h-auto" tabindex=-1 id=offcanvasNavMain aria-labelledby=offcanvasNavMainLabel><div class=offcanvas-header><h5 class=offcanvas-title id=offcanvasNavMainLabel>DefectDojo Documentation</h5><button type=button class="btn btn-link nav-link p-0 ms-auto" data-bs-dismiss=offcanvas aria-label=Close>
<svg class="icon icon-tabler icon-tabler-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg></button></div><div class="offcanvas-body d-flex flex-column flex-lg-row align-items-center"><span id=hs_cos_wrapper_header_logo class="d-flex align-items-center"><img src=/svgs/logo-lightmode.svg class=logo-lightmode alt=DefectDojo width=184>
<img src=/svgs/logo-darkmode.svg class=logo-darkmode alt=DefectDojo width=184>
<span class="ms-2 text-bs-body fw-bold">| docs</span></span><div class="flex-grow-1 d-none d-lg-flex justify-content-center align-items-center"><div class="d-flex align-items-center border rounded px-3"><button type=button id=searchToggleDesktop class="btn btn-link nav-link mx-2 d-none d-lg-block" aria-label="Search website">
<span class=fw-bold>Search docs </span><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg></button></div></div><div class="d-flex align-items-center ms-lg-auto"><button id=buttonColorMode class="btn btn-link mx-auto nav-link p-0 ms-lg-2 me-lg-1" type=button aria-label="Toggle theme">
<svg data-bs-theme-value="dark" class="icon icon-tabler icon-tabler-moon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/></svg>
<svg data-bs-theme-value="light" class="icon icon-tabler icon-tabler-sun" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 108 0 4 4 0 10-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7-.7.7m0 11.4.7.7m-12.1-.7-.7.7"/></svg></button><ul id=socialMenu class="nav mx-auto flex-row order-lg-4"><li class=nav-item><a class="nav-link social-link" href=https://www.youtube.com/@defectdojo><svg width="16" height="16" fill="currentColor" class="bi bi-youtube" viewBox="0 0 16 16"><path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01.0 011.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.01 2.01.0 01-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309.0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.01 2.01.0 01-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82.082 9.716A31 31 0 010 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.01 2.01.0 011.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A1e2 1e2.0 017.858 2zM6.4 5.209v4.818l4.157-2.408z"/></svg><small class="ms-2 visually-hidden">YouTube</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://www.linkedin.com/company/defectdojo/><svg width="16" height="16" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526.0 1.175.0h13.65C15.474.0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487.0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837.0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869.0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274.0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678.0 7.225.0 7.225z"/></svg><small class="ms-2 visually-hidden">Linkedin</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://x.com/defectdojo><svg class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg><small class="ms-2 visually-hidden">X</small></a></li><li class=nav-item><a class="nav-link social-link" href=https://github.com/DefectDojo/django-DefectDojo><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg><small class="ms-2 visually-hidden">GitHub</small></a></li></ul></div></div><div class="w-100 mt-3"><ul class="navbar-nav flex-grow-1"><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/get_started/about/about_defectdojo>Get started ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/import_data/import_intro/comparison/>Import data ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/triage_findings/findings/intro_to_findings/>Triage Findings ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/asset_modelling/hierarchy/pro__assets_organizations/>Model your assets ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/metrics_reports/dashboards/introduction_dashboard/>Metrics & reports ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/automation/api/api-v2-docs/>Automation ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/issue_tracking/intro/intro/>Issue tracking ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/admin/admin_intro/intro/>Admin ⏷</a></li><li class=nav-item><a class=nav-link href=https://docs.defectdojo.com/supported_tools/>Supported tools ⏷</a></li></ul></div></div></div></header></div><div class="wrap container-lg" role=document><div class=content><div class="row flex-xl-nowrap"><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=toc><ul><li><a href=#pre-requisites>Pre-requisites</a><ul><li><a href=#docker-images>Docker images</a></li></ul></li><li><a href=#which-files-do-you-need-to-modify>Which files do you need to modify?</a></li><li><a href=#factory-contract>Factory contract</a></li><li><a href=#api-parsers>API Parsers</a></li><li><a href=#template-generator>Template Generator</a></li><li><a href=#things-to-pay-attention-to>Things to pay attention to</a><ul><li><a href=#do-not-parse-urls-by-hand>Do not parse URLs by hand</a></li><li><a href=#use-the-right-libraries-to-parse-information>Use the right libraries to parse information</a></li><li><a href=#not-all-attributes-are-mandatory>Not all attributes are mandatory</a></li><li><a href=#data-could-be-missing-in-the-source-report>Data could be missing in the source report</a></li><li><a href=#parsing-of-cvss-vectors>Parsing of CVSS vectors</a></li></ul></li><li><a href=#deduplication-algorithm>Deduplication algorithm</a></li><li><a href=#unit-tests>Unit tests</a><ul><li><a href=#use-with-to-open-example-files>Use with to open example files</a></li><li><a href=#test-database>Test database</a></li><li><a href=#run-your-tests>Run your tests</a></li><li><a href=#endpoint-validation>Endpoint validation</a></li><li><a href=#tests-api-parsers>Tests API Parsers</a></li></ul></li><li><a href=#other-files-that-could-be-involved>Other files that could be involved</a><ul><li><a href=#change-to-the-model>Change to the model</a></li><li><a href=#accept-a-different-type-of-file-to-upload>Accept a different type of file to upload</a></li><li><a href=#a-need-for-more-than-just-the-parserpy>A need for more than just the parser.py</a></li></ul></li><li><a href=#pull-request-examples>Pull request examples</a></li><li><a href=#update-the-import-page-documentation>Update the import page documentation</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9 mx-xl-auto"><h1>Contribute to Parsers</h1><nav class="toc-mobile d-xl-none" aria-label="Quaternary navigation"><details><summary>On this page</summary><div class=page-links><nav id=TableOfContents><ul><li><a href=#pre-requisites>Pre-requisites</a><ul><li><a href=#docker-images>Docker images</a></li></ul></li><li><a href=#which-files-do-you-need-to-modify>Which files do you need to modify?</a></li><li><a href=#factory-contract>Factory contract</a></li><li><a href=#api-parsers>API Parsers</a></li><li><a href=#template-generator>Template Generator</a></li><li><a href=#things-to-pay-attention-to>Things to pay attention to</a><ul><li><a href=#do-not-parse-urls-by-hand>Do not parse URLs by hand</a></li><li><a href=#use-the-right-libraries-to-parse-information>Use the right libraries to parse information</a></li><li><a href=#not-all-attributes-are-mandatory>Not all attributes are mandatory</a></li><li><a href=#data-could-be-missing-in-the-source-report>Data could be missing in the source report</a></li><li><a href=#parsing-of-cvss-vectors>Parsing of CVSS vectors</a></li></ul></li><li><a href=#deduplication-algorithm>Deduplication algorithm</a></li><li><a href=#unit-tests>Unit tests</a><ul><li><a href=#use-with-to-open-example-files>Use with to open example files</a></li><li><a href=#test-database>Test database</a></li><li><a href=#run-your-tests>Run your tests</a></li><li><a href=#endpoint-validation>Endpoint validation</a></li><li><a href=#tests-api-parsers>Tests API Parsers</a></li></ul></li><li><a href=#other-files-that-could-be-involved>Other files that could be involved</a><ul><li><a href=#change-to-the-model>Change to the model</a></li><li><a href=#accept-a-different-type-of-file-to-upload>Accept a different type of file to upload</a></li><li><a href=#a-need-for-more-than-just-the-parserpy>A need for more than just the parser.py</a></li></ul></li><li><a href=#pull-request-examples>Pull request examples</a></li><li><a href=#update-the-import-page-documentation>Update the import page documentation</a></li></ul></nav></div></details></nav><p>All commands assume that you&rsquo;re located at the root of the django-DefectDojo cloned repo.</p><h2 id=pre-requisites>Pre-requisites<a href=#pre-requisites class=anchor aria-hidden=true>#</a></h2><ul><li>You have forked https://github.com/DefectDojo/django-DefectDojo and cloned locally.</li><li>Checkout <code>dev</code> and make sure you&rsquo;re up to date with the latest changes.</li><li>It&rsquo;s advised that you create a dedicated branch for your development, such as <code>git checkout -b parser-name</code>.</li></ul><p>It is easiest to use the docker compose deployment as it has hot-reload capbility for uWSGI.
Set up your environment to use the dev environment:</p><p><code>$ docker/setEnv.sh dev</code></p><p>Please have a look at <a href=https://github.com/DefectDojo/django-DefectDojo/blob/master/readme-docs/DOCKER.md>DOCKER.md</a> for more details.</p><h3 id=docker-images>Docker images<a href=#docker-images class=anchor aria-hidden=true>#</a></h3><p>You will want to build your docker images locally, and eventually pass in your local user&rsquo;s <code>uid</code> to be able to write to the image (handy for database migration files). Assuming your user&rsquo;s <code>uid</code> is <code>1000</code>, then:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose build --build-arg <span class=nv>uid</span><span class=o>=</span><span class=m>1000</span></span></span></code></pre></div><h2 id=which-files-do-you-need-to-modify>Which files do you need to modify?<a href=#which-files-do-you-need-to-modify class=anchor aria-hidden=true>#</a></h2><table><thead><tr><th>File</th><th>Purpose</th></tr></thead><tbody><tr><td><code>dojo/tools/&lt;parser_dir>/__init__.py</code></td><td>Empty file for class initialization</td></tr><tr><td><code>dojo/tools/&lt;parser_dir>/parser.py</code></td><td>The meat. This is where you write your actual parser. The class name must be the Python module name without underscores plus <code>Parser</code>. <strong>Example:</strong> When the name of the Python module is <code>dependency_check</code>, the class name shall be <code>DependencyCheckParser</code></td></tr><tr><td><code>unittests/scans/&lt;parser_dir>/{many_vulns,no_vuln,one_vuln}.json</code></td><td>Sample files containing meaningful data for unit tests. The minimal set.</td></tr><tr><td><code>unittests/tools/test_&lt;parser_name>_parser.py</code></td><td>Unit tests of the parser.</td></tr><tr><td><code>dojo/settings/settings.dist.py</code></td><td>If you want to use a modern hashcode based deduplication algorithm</td></tr><tr><td><code>docs/content/supported_tools/&lt;file/api>/&lt;parser_file>.md</code></td><td>Documentation, what kind of file format is required and how it should be obtained</td></tr></tbody></table><h2 id=factory-contract>Factory contract<a href=#factory-contract class=anchor aria-hidden=true>#</a></h2><p>Parsers are loaded dynamicaly with a factory pattern. To have your parser loaded and works correctly, you need to implement the contract.</p><ol><li>your parser <strong>MUST</strong> be in a sub-module of module <code>dojo.tools</code><ul><li>ex: <code>dojo.tools.my_tool.parser</code> module</li></ul></li><li>your parser <strong>MUST</strong> be a class in this sub-module.<ul><li>ex: <code>dojo.tools.my_tool.parser.MyToolParser</code></li></ul></li><li>The name of this class <strong>MUST</strong> be the Python module name without underscores and with <code>Parser</code> suffix.<ul><li>ex: <code>dojo.tools.my_tool.parser.MyToolParser</code></li></ul></li><li>This class <strong>MUST</strong> have an empty constructor or no constructor</li><li>This class <strong>MUST</strong> implement 4 methods:<ol><li><code>def get_scan_types(self)</code> This function return a list of all the <em>scan_type</em> supported by your parser. This identifiers are used internally. Your parser can support more than one <em>scan_type</em>. For example some parsers use different identifier to modify the behavior of the parser (aggregate, filter, etc&mldr;)</li><li><code>def get_label_for_scan_types(self, scan_type):</code> This function return a string used to provide some text in the UI (short label)</li><li><code>def get_description_for_scan_types(self, scan_type):</code> This function return a string used to provide some text in the UI (long description)</li><li><code>def get_findings(self, file, test)</code> This function return a list of findings</li></ol></li><li>If your parser have more than 1 scan_type (for detailled mode) you <strong>MUST</strong> implement <code>def set_mode(self, mode)</code> method</li><li>The parser instance is re-used over all imports performed for this scan_type, so do not store any data at class level</li></ol><p>Example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyToolParser</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_scan_types</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=s2>&#34;My Tool Scan&#34;</span><span class=p>,</span> <span class=s2>&#34;My Tool Scan detailed&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_label_for_scan_types</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>scan_type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>scan_type</span> <span class=o>==</span> <span class=s2>&#34;My Tool Scan&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;My Tool XML Scan aggregated by ...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;My Tool XML Scan&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_description_for_scan_types</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>scan_type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Aggregates findings per cwe, title, description, file_path. SonarQube output file can be imported in HTML format. Generate with https://github.com/soprasteria/sonar-report version &gt;= 1.1.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>requires_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>scan_type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># mode:</span>
</span></span><span class=line><span class=cl>    <span class=c1># None (default): aggregates vulnerabilites per sink filename (legacy behavior)</span>
</span></span><span class=line><span class=cl>    <span class=c1># &#39;detailed&#39; : No aggregation</span>
</span></span><span class=line><span class=cl>    <span class=n>mode</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_mode</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mode</span> <span class=o>=</span> <span class=n>mode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_findings</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>test</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;...&gt;</span></span></span></code></pre></div></figure></div><h2 id=api-parsers>API Parsers<a href=#api-parsers class=anchor aria-hidden=true>#</a></h2><p>DefectDojo has a limited number of API parsers. While we won&rsquo;t remove these connectors, adding API connectors has been problematic and thus we cannot accept new API parsers / connectors from the community at this time for supportability reasonsing. To maintain a high quality API connector, it is necessary to have a license to the tool. To get that license requires partnership with the author or vendor. We&rsquo;re close to announcing a new program to help address this and bring API connectors to DefectDojo.</p><h2 id=template-generator>Template Generator<a href=#template-generator class=anchor aria-hidden=true>#</a></h2><p>Use the <a href=https://github.com/DefectDojo/cookiecutter-scanner-parser>template</a> parser to quickly generate the files required. To get started you will need to install <a href=https://github.com/cookiecutter/cookiecutter>cookiecutter</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pip install cookiecutter</span></span></code></pre></div><p>Then generate your scanner parser from the root of django-DefectDojo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cookiecutter https://github.com/DefectDojo/cookiecutter-scanner-parser</span></span></code></pre></div><p>Read <a href=https://github.com/DefectDojo/cookiecutter-scanner-parser>more</a> on the template configuration variables.</p><h2 id=things-to-pay-attention-to>Things to pay attention to<a href=#things-to-pay-attention-to class=anchor aria-hidden=true>#</a></h2><p>Here is a list of considerations that will make the parser robust for both common cases and edge cases.</p><h3 id=do-not-parse-urls-by-hand>Do not parse URLs by hand<a href=#do-not-parse-urls-by-hand class=anchor aria-hidden=true>#</a></h3><p>We use 2 modules to handle endpoints:</p><ul><li><code>hyperlink</code></li><li><code>dojo.models</code> with a specific class to handle processing around URLs to create endpoints <code>Endpoint</code>.</li></ul><p>All the existing parser use the same code to parse URL and create endpoints.
Using <code>Endpoint.from_uri()</code> is the best way to create endpoints.
If you really need to parse an URL, use <code>hyperlink</code> module.</p><p>Good example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;url&#34;</span> <span class=ow>in</span> <span class=n>item</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>endpoint</span> <span class=o>=</span> <span class=n>Endpoint</span><span class=o>.</span><span class=n>from_uri</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>finding</span><span class=o>.</span><span class=n>unsaved_endpoints</span> <span class=o>=</span> <span class=p>[</span><span class=n>endpoint</span><span class=p>]</span></span></span></code></pre></div></figure></div><p>Very bad example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=n>u</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&#34;url&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>endpoint</span> <span class=o>=</span> <span class=n>Endpoint</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>u</span><span class=o>.</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>finding</span><span class=o>.</span><span class=n>unsaved_endpoints</span> <span class=o>=</span> <span class=p>[</span><span class=n>endpoint</span><span class=p>]</span></span></span></code></pre></div></figure></div><h3 id=use-the-right-libraries-to-parse-information>Use the right libraries to parse information<a href=#use-the-right-libraries-to-parse-information class=anchor aria-hidden=true>#</a></h3><p>Various file formats are handled through libraries. In order to keep DefectDojo slim and also don&rsquo;t extend the attack surface, keep the number of libraries used minimal and take other parsers as an example.</p><h4 id=defusedxml-in-favour-of-lxml>defusedXML in favour of lxml<a href=#defusedxml-in-favour-of-lxml class=anchor aria-hidden=true>#</a></h4><p>As xml is by default an unsecure format, the information parsed from various xml output has to be parsed in a secure way. Within an evaluation, we determined that defusedXML is the library which we will use in the future to parse xml files in parsers as this library is rated more secure. Thus, we will only accept PRs with the defusedxml library.</p><h3 id=not-all-attributes-are-mandatory>Not all attributes are mandatory<a href=#not-all-attributes-are-mandatory class=anchor aria-hidden=true>#</a></h3><p>Parsers may have many fields, out of which many of them may be optional.
It better to not set attribute if you don&rsquo;t have data instead of filling with values like <code>NA</code>, <code>No data</code> etc&mldr;</p><p>Check class <code>dojo.models.Finding</code></p><h3 id=data-could-be-missing-in-the-source-report>Data could be missing in the source report<a href=#data-could-be-missing-in-the-source-report class=anchor aria-hidden=true>#</a></h3><p>Always make sure you include checks to avoid potential <code>KeyError</code> errors (e.g. field does not exist), for those fields you are not absolutely certain will always be in file that will get uploaded. These translate to 500 error, and do not look good.</p><p>Good example:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>   <span class=k>if</span> <span class=s2>&#34;mykey&#34;</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>       <span class=n>finding</span><span class=o>.</span><span class=n>cwe</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s2>&#34;mykey&#34;</span><span class=p>]</span></span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>   <span class=n>finding</span><span class=o>.</span><span class=n>cwe</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;mykey&#34;</span><span class=p>,</span> <span class=mi>123</span><span class=p>)</span></span></span></code></pre></div></figure></div><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>   <span class=n>some_list</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;key_of_the_list&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span></span></span></code></pre></div></figure></div><p>The finale example guards against cases where <code>key_of_the_list</code> is present, but <code>null</code>.</p><h3 id=parsing-of-cvss-vectors>Parsing of CVSS vectors<a href=#parsing-of-cvss-vectors class=anchor aria-hidden=true>#</a></h3><p>Data can have <code>CVSS</code> vectors or scores. Defect Dojo use the <code>cvss</code> module provided by RedHat Security.
There&rsquo;s also a helper method to validate the vector and extract the base score and severity from it.</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>dojo.utils</span> <span class=kn>import</span> <span class=n>parse_cvss_data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cvss_vector</span> <span class=o>=</span> <span class=o>&lt;</span><span class=n>get</span> <span class=n>CVSS3</span> <span class=ow>or</span> <span class=n>CVSS4</span> <span class=n>vector</span> <span class=kn>from</span> <span class=nn>the</span> <span class=n>report</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>cvss_data</span> <span class=o>=</span> <span class=n>parse_cvss_data</span><span class=p>(</span><span class=n>cvss_vector</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>cvss_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>finding</span><span class=o>.</span><span class=n>severity</span> <span class=o>=</span> <span class=n>cvss_data</span><span class=p>[</span><span class=s2>&#34;severity&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>finding</span><span class=o>.</span><span class=n>cvssv3</span> <span class=o>=</span> <span class=n>cvss_data</span><span class=p>[</span><span class=s2>&#34;cvssv3&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>finding</span><span class=o>.</span><span class=n>cvssv4</span> <span class=o>=</span> <span class=n>cvss_data</span><span class=p>[</span><span class=s2>&#34;cvssv4&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1># we don&#39;t set any score fields as those will be overwritten by Defect Dojo</span></span></span></code></pre></div></figure></div><p>Not all values have to be used as scan reports usually provide their own value for <code>severity</code>.
And sometimes also for <code>cvss_score</code>. Defect Dojo will not overwrite any <code>cvss3_score</code> or <code>cvss4_score</code>.
If no score is set, Defect Dojo will use the <code>cvss</code> library to calculate the score.
The response also has the detected major version of the CVSS vector in <code>cvss_data["major_version"]</code>.</p><p>If you need more manual processing, you can parse the <code>CVSS</code> vector directly.</p><p>Example of use:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>cvss.parser</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>cvss</span> <span class=kn>import</span> <span class=n>CVSS2</span><span class=p>,</span> <span class=n>CVSS3</span><span class=p>,</span> <span class=n>CVSS4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># TEMPORARY: Use Defect Dojo implementation of `parse_cvss_from_text` white waiting for https://github.com/RedHatProductSecurity/cvss/pull/75 to be released</span>
</span></span><span class=line><span class=cl>    <span class=n>vectors</span> <span class=o>=</span> <span class=n>cvss</span><span class=o>.</span><span class=n>parser</span><span class=o>.</span><span class=n>parse_cvss_from_text</span><span class=p>(</span><span class=s2>&#34;CVSS:3.0/S:C/C:H/I:H/A:N/AV:P/AC:H/PR:H/UI:R/E:H/RL:O/RC:R/CR:H/IR:X/AR:X/MAC:H/MPR:X/MUI:X/MC:L/MA:X&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>vectors</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>vectors</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=ow>is</span> <span class=n>CVSS3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>vectors</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>severities</span><span class=p>())</span>  <span class=c1># this is the 3 severities</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>cvssv3</span> <span class=o>=</span> <span class=n>vectors</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>clean_vector</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>severity</span> <span class=o>=</span> <span class=n>vectors</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>severities</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>vectors</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>compute_base_score</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>cvssv3_score</span> <span class=o>=</span> <span class=n>vectors</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>scores</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>finding</span><span class=o>.</span><span class=n>severity</span> <span class=o>=</span> <span class=n>severity</span>
</span></span><span class=line><span class=cl>            <span class=n>finding</span><span class=o>.</span><span class=n>cvssv3_score</span> <span class=o>=</span> <span class=n>cvssv3_score</span></span></span></code></pre></div></figure></div><p>Do not do something like this:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><pre tabindex=0><code>    def get_severity(self, cvss, cvss_version=&#34;2.0&#34;):
        cvss = float(cvss)
        cvss_version = float(cvss_version[:1])
        # If CVSS Version 3 and above
        if cvss_version &gt;= 3:
            if cvss &gt; 0 and cvss &lt; 4:
                return &#34;Low&#34;
            elif cvss &gt;= 4 and cvss &lt; 7:
                return &#34;Medium&#34;
            elif cvss &gt;= 7 and cvss &lt; 9:
                return &#34;High&#34;
            elif cvss &gt;= 9:
                return &#34;Critical&#34;
            else:
                return &#34;Informational&#34;
        # If CVSS Version prior to 3
        else:
            if cvss &gt; 0 and cvss &lt; 4:
                return &#34;Low&#34;
            elif cvss &gt;= 4 and cvss &lt; 7:
                return &#34;Medium&#34;
            elif cvss &gt;= 7 and cvss &lt;= 10:
                return &#34;High&#34;
            else:
                return &#34;Informational&#34;</code></pre></figure></div><h2 id=deduplication-algorithm>Deduplication algorithm<a href=#deduplication-algorithm class=anchor aria-hidden=true>#</a></h2><p>By default a new parser uses the &rsquo;legacy&rsquo; deduplication algorithm documented at https://docs.defectdojo.com/open_source/archived_docs/usage/features/#deduplication</p><p>Please use a pre-defined deduplication algorithm where applicable. When using the <code>unique_id_from_tool</code> or <code>vuln_id_from_tool</code> fields in the hash code configuration, it&rsquo;s important that these are uqniue for the finding and constant over time across subsequent scans. If this is not the case, the values can still be useful to set on the finding model without using them for deduplication.
The values must be coming from the report directly and must not be something that is calculated by the parser internally.</p><h2 id=unit-tests>Unit tests<a href=#unit-tests class=anchor aria-hidden=true>#</a></h2><p>Each parser must have unit tests, at least to test for 0 vuln, 1 vuln and many vulns. You can take a look at how other parsers have them for starters. The more quality tests, the better.</p><p>It&rsquo;s important to add checks on attributes of findings.
For ex:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>        <span class=k>with</span> <span class=bp>self</span><span class=o>.</span><span class=n>subTest</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>finding</span> <span class=o>=</span> <span class=n>findings</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=s2>&#34;test title&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>title</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>active</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>verified</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>duplicate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertIn</span><span class=p>(</span><span class=n>finding</span><span class=o>.</span><span class=n>severity</span><span class=p>,</span> <span class=n>Finding</span><span class=o>.</span><span class=n>SEVERITIES</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=s2>&#34;CVE-2020-36234&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>vulnerability_ids</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=mi>261</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>cwe</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=s2>&#34;CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>cvssv3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertIn</span><span class=p>(</span><span class=s2>&#34;security&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>tags</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertIn</span><span class=p>(</span><span class=s2>&#34;network&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>tags</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=s2>&#34;3287f2d0-554f-491b-8516-3c349ead8ee5&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>unique_id_from_tool</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span><span class=s2>&#34;TEST1&#34;</span><span class=p>,</span> <span class=n>finding</span><span class=o>.</span><span class=n>vuln_id_from_tool</span><span class=p>)</span></span></span></code></pre></div></figure></div><h3 id=use-with-to-open-example-files>Use with to open example files<a href=#use-with-to-open-example-files class=anchor aria-hidden=true>#</a></h3><p>In order to make certain that file handles are closed properly, please use the with pattern to open files.
Instead of:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=n>testfile</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;path_to_file.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=n>testfile</span><span class=o>.</span><span class=n>close</span><span class=p>()</span></span></span></code></pre></div></figure></div><p>use:</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;path_to_file.json&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>testfile</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span></span></span></code></pre></div></figure></div><p>This ensures the file is closed at the end of the with statement, even if an exception occurs somewhere in the block.</p><h3 id=test-database>Test database<a href=#test-database class=anchor aria-hidden=true>#</a></h3><p>Django uses a separate test database for running unit tests called <code>test_defectdojo</code>. It&rsquo;s automatically created and initialized with a basic set of test data.</p><h3 id=run-your-tests>Run your tests<a href=#run-your-tests class=anchor aria-hidden=true>#</a></h3><p>This local command will launch the unit test for your new parser</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose <span class=nb>exec</span> uwsgi bash -c <span class=s1>&#39;python manage.py test unittests.tools.&lt;your_unittest_py_file&gt;.&lt;main_class_name&gt; -v2&#39;</span></span></span></code></pre></div><p>or like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ./run-unittest.sh --test-case unittests.tools.&lt;your_unittest_py_file&gt;.&lt;main_class_name&gt;</span></span></code></pre></div><p>Example for the aqua parser:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose <span class=nb>exec</span> uwsgi bash -c <span class=s1>&#39;python manage.py test unittests.tools.test_aqua_parser.TestAquaParser -v2&#39;</span></span></span></code></pre></div><p>or like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ./run-unittest.sh --test-case unittests.tools.test_aqua_parser.TestAquaParser</span></span></code></pre></div><p>If you want to run all parser unit tests, simply run <code>$ docker-compose exec uwsgi bash -c 'python manage.py test -p "test_*_parser.py" -v2'</code></p><h3 id=endpoint-validation>Endpoint validation<a href=#endpoint-validation class=anchor aria-hidden=true>#</a></h3><p>Some types of parsers create a list of endpoints that are vulnerable (they are stored in <code>finding.unsaved_endpoints</code>). DefectDojo requires storing endpoints in a specific format (which follow RFCs). Endpoints that do not follow this format can be stored but they will be marked as broken (red flag 🚩in UI). To be sure your parse store endpoints in the correct format run the <code>.clean()</code> function for all endpoints in unit tests</p><div class=expressive-code><figure class="frame not-content"><figcaption class=header><span class=title></span></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>findings</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>get_findings</span><span class=p>(</span><span class=n>testfile</span><span class=p>,</span> <span class=n>Test</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>finding</span> <span class=ow>in</span> <span class=n>findings</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>endpoint</span> <span class=ow>in</span> <span class=n>finding</span><span class=o>.</span><span class=n>unsaved_endpoints</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>endpoint</span><span class=o>.</span><span class=n>clean</span><span class=p>()</span></span></span></code></pre></div></figure></div><h3 id=tests-api-parsers>Tests API Parsers<a href=#tests-api-parsers class=anchor aria-hidden=true>#</a></h3><p>Not only parser but also importer should be tested.
<code>patch</code> method from <code>unittest.mock</code> is usualy usefull for simulating API responses.
It is highly recommeded to use it.</p><h2 id=other-files-that-could-be-involved>Other files that could be involved<a href=#other-files-that-could-be-involved class=anchor aria-hidden=true>#</a></h2><h3 id=change-to-the-model>Change to the model<a href=#change-to-the-model class=anchor aria-hidden=true>#</a></h3><p>In the event where you&rsquo;d have to change the model, e.g. to increase a database column size to accomodate a longer string of data to be saved</p><ul><li><p>Change what you need in <code>dojo/models.py</code></p></li><li><p>Create a new migration file in dojo/db_migrations by running and including as part of your PR</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose <span class=nb>exec</span> uwsgi bash -c <span class=s1>&#39;python manage.py makemigrations -v2&#39;</span></span></span></code></pre></div></li></ul><h3 id=accept-a-different-type-of-file-to-upload>Accept a different type of file to upload<a href=#accept-a-different-type-of-file-to-upload class=anchor aria-hidden=true>#</a></h3><p>If you want to be able to accept a new type of file for your parser, take a look at <code>dojo/forms.py</code> around line 436 (at the time of this writing) or locate the 2 places (for import and re-import) where you find the string <code>attrs={"accept":</code>.</p><p>Formats currently accepted: .xml, .csv, .nessus, .json, .html, .js, .zip.</p><h3 id=a-need-for-more-than-just-the-parserpy>A need for more than just the parser.py<a href=#a-need-for-more-than-just-the-parserpy class=anchor aria-hidden=true>#</a></h3><p>Of course, nothing prevents you from having more files than the <code>parser.py</code> file. It&rsquo;s python :-)</p><h2 id=pull-request-examples>Pull request examples<a href=#pull-request-examples class=anchor aria-hidden=true>#</a></h2><p>If you want to take a look at previous parsers that are now part of DefectDojo, take a look at https://github.com/DefectDojo/django-DefectDojo/pulls?q=is%3Apr+sort%3Aupdated-desc+label%3A%22Import+Scans%22+is%3Aclosed</p><h2 id=update-the-import-page-documentation>Update the import page documentation<a href=#update-the-import-page-documentation class=anchor aria-hidden=true>#</a></h2><p>Please add a new .md file in [<code>docs/content/en/connecting_your_tools/parsers</code>] with the details of your new parser. Include the following content headings:</p><ul><li>Acceptable File Type(s) - please include how to generate this type of file from the related tool, as some tools have multiple methods or require specific commands.</li><li>An example unit test block, if applicable.</li><li>A link to the relevant unit tests folder so that users can quickly navigate there from Documentation.</li><li>A link to the scanner itself - (e.g. GitHub or vendor link)</li></ul><p>Here is an example of a completed Parser documentation page: <a href=https://github.com/DefectDojo/django-DefectDojo/blob/master/docs/content/supported_tools/file/acunetix.md>https://github.com/DefectDojo/django-DefectDojo/blob/master/docs/content/supported_tools/file/acunetix.md</a></p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="page-nav d-flex flex-column flex-sm-row"><div class="card text-end w-100"><div class="card-body d-flex justify-content-end"><div class="d-flex flex-column"><div class=text-body-secondary>Next</div><a href=/open_source/notification_webhooks/how_to/ class="stretched-link text-reset text-decoration-none">Notification Webhooks Setup</a></div><div class="d-flex flex-column justify-content-center"><svg class="icon icon-tabler icon-tabler-arrow-right" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12h14"/><path d="M13 18l6-6"/><path d="M13 6l6 6"/></svg></div></div></div></div></main></div></div></div><footer class="footer text-muted"><div class=container-lg><div class=row><div class="col-lg-8 text-center text-lg-start"><ul class=list-inline><li class=list-inline-item><a class=text-muted href=/></a></li></ul></div><div class="col-lg-8 text-center text-lg-end"><ul class=list-inline><li class=list-inline-item></li></ul></div></div></div></footer><script async src=/js/app.b0f012dbaf29743a79ede71e0264ee36932ab4a68ba3f42fe76e93dbda9c2a4d.js integrity="sha256-sPAS268pdDp57eceAmTuNpMqtKaLo/Qv526T29qcKk0="></script><script async src=/js/docsearch.ec1c4b79a2747e00967d8af10545b6cbd502d385b2b34c5be060a4bc1b73f31c.js integrity="sha256-7BxLeaJ0fgCWfYrxBUW2y9UC04Wys0xb4GCkvBtz8xw="></script></body></html>