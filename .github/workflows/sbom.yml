name: Generate SBOM

on:
  workflow_dispatch:
  push:

jobs:
  cdxgen:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Run cdxgen
        run: |
          docker run --rm -v /tmp:/tmp -v $(pwd):/app:rw -t ghcr.io/appthreat/cdxgen-python:v10 \
            --project-name django-DefectDojo --project-version $(git rev-parse --short "$GITHUB_SHA") \
            -r /app -o /app/bom.json -t python --deep -p
      - uses: actions/upload-artifact@v4
        with:
          name: sbom
          path: 'bom.json'
